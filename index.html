<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>O Corvo de Hekate | Feliz Yule!</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;500;600;700;900&family=Lato:wght@300;400;700&display=swap" rel="stylesheet">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        void: '#050505',
                        gold: {
                            400: '#D4AF37', // Ouro Cl√°ssico
                            500: '#C5A028',
                            900: '#3D3008',
                        },
                        obsidian: '#0f0f10',
                        yuleRed: '#8B0000', // Vermelho Sangue de Yule
                        pineGreen: '#0F3B25' // Verde Pinheiro Sombrio
                    },
                    fontFamily: {
                        display: ['Cinzel', 'serif'],
                        body: ['Lato', 'sans-serif'],
                    }
                }
            }
        }
    </script>

    <style>
        /* ESTILOS GERAIS & YULE */
        body { background-color: #050505; color: #e5e5e5; overflow-x: hidden; }
        
        /* Scrollbar Festiva Sombria */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #000; }
        ::-webkit-scrollbar-thumb { background: linear-gradient(to bottom, #8B0000, #D4AF37); border-radius: 3px; }

        .glass-dark {
            background: rgba(20, 20, 20, 0.7);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(212, 175, 55, 0.1);
        }

        .text-gold-gradient {
            background: linear-gradient(to right, #AA8C2C, #F2E3BC, #D4AF37, #AA8C2C);
            -webkit-background-clip: text; background-clip: text; color: transparent; background-size: 200% auto; animation: shine 5s linear infinite;
        }
        @keyframes shine { to { background-position: 200% center; } }
        .fade-in-up { animation: fadeInUp 0.8s ease-out forwards; opacity: 0; transform: translateY(20px); }
        @keyframes fadeInUp { to { opacity: 1; transform: translateY(0); } }
        #intro-sequence { position: fixed; inset: 0; background: #000; z-index: 9999; display: flex; align-items: center; justify-content: center; }
        
        /* CARDS DECORADOS DE NATAL */
        .project-card {
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative; overflow: hidden;
        }
        /* Adiciona um toque de azevinho no canto */
        .project-card::after {
            content: '‚ùÑÔ∏è'; /* Um toque sutil de natureza/Yule */
            position: absolute; top: 10px; right: 10px; font-size: 1.5rem; opacity: 0.3; filter: grayscale(0.5) sepia(1) hue-rotate(-50deg); transition: 0.4s;
        }
        .project-card:hover::after { opacity: 0.8; filter: none; transform: rotate(15deg); }
        
        .project-card:hover {
            transform: translateY(-5px);
            border-color: #D4AF37;
            /* Brilho misto Dourado/Vermelho Yule */
            box-shadow: 0 10px 40px -10px rgba(212, 175, 55, 0.2), 0 0 20px rgba(139, 0, 0, 0.2);
        }
        
        .input-luxe { background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.1); color: #fff; transition: 0.3s; }
        .input-luxe:focus { outline: none; border-color: #D4AF37; background: rgba(212, 175, 55, 0.05); }

        /* --- ANIMA√á√ÉO DO CORVO SVG (COM GORRO) --- */
        .mystic-crow-svg {
            filter: drop-shadow(0 0 15px rgba(212, 175, 55, 0.4));
            animation: hoverCrow 4s ease-in-out infinite alternate;
        }
        .crow-wing-left { transform-origin: center; animation: flapLeft 1.2s ease-in-out infinite alternate; }
        .crow-wing-right { transform-origin: center; animation: flapRight 1.2s ease-in-out infinite alternate; }
        .santa-hat-group { transform-origin: center; animation: hatBob 1.2s ease-in-out infinite alternate; }

        @keyframes hoverCrow { 0% { transform: translateY(0); } 100% { transform: translateY(-15px); } }
        @keyframes flapLeft { 0% { transform: rotate(0deg) translateY(0); } 100% { transform: rotate(-10deg) translateY(5px); } }
        @keyframes flapRight { 0% { transform: rotate(0deg) translateY(0); } 100% { transform: rotate(10deg) translateY(5px); } }
        @keyframes hatBob { 0% { transform: rotate(0deg) translateY(0); } 100% { transform: rotate(-5deg) translateY(2px); } }

        /* --- EFEITO DE NEVE (CSS PURO LEVE) --- */
        .snow-container { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 1; overflow: hidden; }
        .snowflake {
            position: absolute; top: -10px; color: #fff; font-size: 1em; opacity: 0;
            animation: fall linear infinite;
        }
        @keyframes fall {
            0% { opacity: 0; transform: translateY(0) rotate(0deg); }
            20% { opacity: 0.7; }
            100% { opacity: 0; transform: translateY(100vh) rotate(360deg); }
        }
    </style>
</head>
<body class="antialiased">

    <div class="snow-container" id="snow"></div>
    <script>
        // Script leve para gerar flocos
        const snowContainer = document.getElementById('snow');
        const snowflakeCount = 50; // Quantidade de flocos
        for (let i = 0; i < snowflakeCount; i++) {
            const snowflake = document.createElement('div');
            snowflake.className = 'snowflake';
            snowflake.innerHTML = '‚ùÑ';
            snowflake.style.left = Math.random() * 100 + '%';
            snowflake.style.animationDuration = Math.random() * 10 + 5 + 's'; // Velocidade variada
            snowflake.style.animationDelay = Math.random() * 5 + 's';
            snowflake.style.fontSize = Math.random() * 10 + 8 + 'px';
            snowflake.style.color = Math.random() > 0.8 ? '#D4AF37' : '#ffffff'; // Alguns flocos dourados
            snowContainer.appendChild(snowflake);
        }
    </script>

    <div id="intro-sequence">
        <div style="width: 100%; max-width: 1000px; padding: 20px;"> 
            <div style="padding:56.25% 0 0 0;position:relative;">
                <iframe src="https://player.vimeo.com/video/1136095667?badge=0&autopause=0&player_id=0&app_id=58479&autoplay=1&muted=1&controls=0&title=0&byline=0&portrait=0" frameborder="0" allow="autoplay; fullscreen; picture-in-picture" style="position:absolute;top:0;left:0;width:100%;height:100%;" title="Intro"></iframe>
            </div>
            <button onclick="forceOpenSite()" class="absolute bottom-10 left-1/2 transform -translate-x-1/2 text-gray-500 text-[10px] uppercase tracking-widest hover:text-white transition z-50">
                Pular Intro
            </button>
        </div>
    </div>

    <div id="app-root" style="display: none; opacity: 0;">
        
        <div id="loading-spinner" class="fixed inset-0 bg-black/90 z-50 flex flex-col items-center justify-center hidden">
            <div class="relative animate-bounce mb-4">
                <i class="fas fa-crow text-4xl text-gold-400"></i>
                <i class="fas fa-holly-berry absolute -top-2 -right-2 text-yuleRed text-sm"></i>
            </div>
            <p class="text-gold-400 text-xs tracking-[0.3em] uppercase animate-pulse">Comemorando Yule...</p>
        </div>

        <header class="fixed top-0 w-full z-40 bg-void/90 backdrop-blur border-b border-gold-900/30 h-20 transition-all duration-300">
            <div class="container mx-auto px-6 h-full flex justify-between items-center">
                <div class="flex items-center gap-3 cursor-pointer group" onclick="showView('home-view')">
                    <img src="https://i.ibb.co/2705r709/Black-Friday.png" alt="Logo" class="h-10 w-auto opacity-80 group-hover:opacity-100 transition filter drop-shadow-[0_0_5px_rgba(212,175,55,0.3)]">
                    <div class="flex flex-col">
                        <span class="text-[10px] text-gold-400 uppercase tracking-[0.3em]">O Coven do</span>
                        <h1 class="text-lg font-display text-white tracking-widest group-hover:text-gold-400 transition flex items-center gap-2">CORVO <i class="fas fa-holly-berry text-yuleRed text-xs opacity-50 group-hover:opacity-100 transition"></i></h1>
                    </div>
                </div>

                <nav class="hidden md:flex items-center space-x-8">
                    <button data-view="home-view" class="internal-link text-xs font-display font-bold tracking-[0.2em] text-gray-400 hover:text-white uppercase transition">Santu√°rio</button>
                    <button data-view="blog-view" class="internal-link text-xs font-display font-bold tracking-[0.2em] text-gray-400 hover:text-white uppercase transition">Grim√≥rio</button>
                    <button data-view="sobre-view" class="internal-link text-xs font-display font-bold tracking-[0.2em] text-gray-400 hover:text-white uppercase transition">Sacerdote</button>
                    <div class="w-[1px] h-4 bg-white/10"></div>
                    <a href="https://ardanraven.github.io/Calendario/" target="_blank" class="text-gray-400 hover:text-gold-400" title="Calend√°rio"><i class="fas fa-moon"></i></a>
                    <a href="https://caminhodatocha.site" target="_blank" class="border border-gold-900/50 text-gold-400 px-5 py-2 text-[10px] uppercase tracking-widest hover:bg-gold-900 hover:text-white transition font-bold relative overflow-hidden group">
                        <span class="relative z-10">Fazer Parte do Coven</span>
                        <div class="absolute inset-0 bg-gradient-to-r from-yuleRed/20 to-gold-900/20 opacity-0 group-hover:opacity-100 transition"></div>
                    </a>
                </nav>

                <div class="flex items-center gap-4">
                    <div id="user-info" class="hidden items-center gap-3">
                        <span id="user-email" class="text-[10px] text-gray-500 hidden sm:inline"></span>
                        <button id="logout-btn" class="text-gray-400 hover:text-red-500"><i class="fas fa-power-off"></i></button>
                    </div>
                    <button id="login-btn" class="hidden text-xs font-display text-gold-400 uppercase tracking-widest hover:text-white border-b border-transparent hover:border-gold-400 pb-1">Login</button>
                    <button id="mobile-menu-btn" class="md:hidden text-gold-400 text-xl"><i class="fas fa-bars"></i></button>
                </div>
            </div>
        </header>

        <div id="mobile-menu" class="hidden fixed inset-0 z-30 bg-black pt-24 px-8 md:hidden">
            <div class="flex flex-col gap-6 text-center">
                <button data-view="home-view" class="internal-link text-2xl font-display text-white py-2 border-b border-white/10">Santu√°rio</button>
                <button data-view="blog-view" class="internal-link text-2xl font-display text-white py-2 border-b border-white/10">Grim√≥rio</button>
                <button data-view="sobre-view" class="internal-link text-2xl font-display text-white py-2 border-b border-white/10">Sacerdote</button>
                <a href="https://caminhodatocha.site" class="text-gold-400 text-xl font-display py-2"><i class="fas fa-gift mr-2"></i>Coven</a>
                <button onclick="document.getElementById('mobile-menu').classList.add('hidden')" class="text-gray-500 mt-8 uppercase text-xs">Fechar</button>
            </div>
        </div>

        <main class="pt-20 min-h-screen relative z-10">
            
            <div id="home-view" class="view-container">
                
                <section class="relative min-h-[85vh] flex flex-col items-center justify-center text-center px-4 overflow-hidden">
                    <div class="absolute inset-0 z-0 opacity-30 bg-[radial-gradient(circle_at_center,_var(--tw-gradient-stops))] from-yuleRed/20 via-obsidian to-black"></div>
                    <div class="absolute top-1/4 left-1/4 w-96 h-96 bg-gold-900/10 rounded-full blur-[100px] pointer-events-none animate-pulse"></div>
                    
                    <div class="relative z-10 max-w-4xl mx-auto space-y-6">
                        <div class="flex justify-center mb-4 relative">
                            <i class="fas fa-star-of-life text-2xl text-gold-500 animate-spin-slow opacity-50"></i>
                        </div>
                        <h2 class="text-gold-500 text-xs md:text-sm tracking-[0.6em] uppercase fade-in-up flex items-center justify-center gap-3" style="animation-delay: 0.1s">
                            <span class="h-[1px] w-8 bg-gold-500"></span> Celebra√ß√£o de Yule <span class="h-[1px] w-8 bg-gold-500"></span>
                        </h2>
                        <h1 class="text-5xl md:text-7xl lg:text-9xl font-display font-black text-white leading-tight fade-in-up" style="animation-delay: 0.3s">
                            O COVEN DO <br><span class="text-gold-gradient">CORVO</span>
                        </h1>
                        <div class="h-[1px] w-24 bg-gradient-to-r from-transparent via-yuleRed to-transparent mx-auto my-6 fade-in-up" style="animation-delay: 0.5s"></div>
                        <p class="text-gray-300 max-w-2xl mx-auto text-lg md:text-xl font-body font-light leading-relaxed fade-in-up" style="animation-delay: 0.6s">
                            Neste solst√≠cio, os caminhos se cruzam e a magia antiga sussurra. <br>
                            Seja bem-vindo a nossa plataforma de Estudos.
                        </p>
                        <div class="pt-8 flex flex-col md:flex-row gap-6 justify-center items-center fade-in-up" style="animation-delay: 0.8s">
                            <button data-view="blog-view" class="internal-link px-10 py-4 bg-transparent border border-gold-400 text-gold-400 font-display text-sm font-bold tracking-[0.2em] uppercase hover:bg-gold-900/50 hover:text-white transition shadow-[0_0_20px_rgba(212,175,55,0.1)] relative group overflow-hidden">
                                <span class="relative z-10">Abrir o Grim√≥rio)</span>
                                <div class="absolute inset-0 bg-gradient-to-r from-yuleRed/10 to-gold-500/10 opacity-0 group-hover:opacity-100 transition"></div>
                            </button>
                        </div>
                    </div>
                </section>

                <section id="about-section" class="py-24 px-6 bg-obsidian border-t border-gold-900/30 relative overflow-hidden">
                    <div class="absolute top-0 left-0 w-full h-full bg-[radial-gradient(ellipse_at_top,_var(--tw-gradient-stops))] from-yuleRed/5 via-transparent to-transparent pointer-events-none"></div>

                    <div class="max-w-6xl mx-auto grid md:grid-cols-2 gap-16 items-center relative z-10">
                        <div class="order-2 md:order-1 space-y-8 text-justify">
                            <h3 class="text-3xl font-display text-white flex items-center gap-4">
                                <i class="fas fa-gift text-yuleRed text-2xl"></i> O Mensageiro Festivo
                            </h3>
                            <p class="text-gray-400 font-body leading-loose text-lg">
                                Mesmo nas noites mais longas do inverno, o <strong>Corvo</strong> vigia. Antigamente, eles eram os olhos dos deuses; hoje, trazem os presentes do conhecimento oculto.
                            </p>
                            <p class="text-gray-400 font-body leading-loose text-lg">
                                Hekate, a Senhora das Encruzilhadas, segura as chaves do cosmos e aben√ßoa este Yule. Este blog √© o nosso ponto de encontro para celebrar a luz que renasce na escurid√£o.
                            </p>
                            <div class="pt-4 flex items-center gap-4">
                                <i class="fas fa-key text-gold-500"></i>
                                <p class="text-gold-400 font-display text-sm tracking-widest uppercase">Feliz Yule, Sacerdote Leonardo</p>
                            </div>
                        </div>
                        <div class="order-1 md:order-2 flex justify-center relative h-96 items-center">
                             <div class="absolute inset-0 bg-gradient-to-br from-gold-500/10 to-yuleRed/10 blur-[100px] rounded-full pointer-events-none animate-pulse"></div>
                            
                            <svg class="mystic-crow-svg w-full h-full max-w-md" viewBox="0 0 500 500" xmlns="http://www.w3.org/2000/svg">
                                <defs>
                                    <linearGradient id="crowGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                                        <stop offset="0%" style="stop-color:#3a3a3a;stop-opacity:1" />
                                        <stop offset="100%" style="stop-color:#0a0a0a;stop-opacity:1" />
                                    </linearGradient>
                                    <linearGradient id="hatGradient" x1="0%" y1="0%" x2="0%" y2="100%">
                                        <stop offset="0%" style="stop-color:#D4AF37;stop-opacity:1" />
                                        <stop offset="100%" style="stop-color:#8B0000;stop-opacity:1" />
                                    </linearGradient>
                                    <filter id="goldGlow">
                                        <feGaussianBlur stdDeviation="2.5" result="coloredBlur"/>
                                        <feMerge>
                                            <feMergeNode in="coloredBlur"/>
                                            <feMergeNode in="SourceGraphic"/>
                                        </feMerge>
                                    </filter>
                                </defs>
                                
                                <g class="crow-body" fill="url(#crowGradient)" stroke="#D4AF37" stroke-width="1.5" filter="url(#goldGlow)">
                                    <path d="M250,200 C220,250 230,350 250,400 C270,350 280,250 250,200 Z" />
                                    <path d="M250,200 C230,180 230,150 250,130 C270,150 270,180 250,200 Z" />
                                    <path d="M250,130 L240,110 L260,110 Z" fill="#D4AF37"/>
                                    
                                    <g class="crow-wing-left">
                                        <path d="M230,220 C150,200 50,150 20,100 C80,150 180,250 230,280 Z" opacity="0.9"/>
                                        <path d="M235,230 C160,220 70,180 40,130 C100,180 190,260 235,290 Z" opacity="0.7"/>
                                    </g>

                                    <g class="crow-wing-right">
                                        <path d="M270,220 C350,200 450,150 480,100 C420,150 320,250 270,280 Z" opacity="0.9"/>
                                         <path d="M265,230 C340,220 430,180 460,130 C400,180 310,260 265,290 Z" opacity="0.7"/>
                                    </g>
                                    
                                    <circle cx="250" cy="165" r="5" fill="#D4AF37" filter="url(#goldGlow)"/>
                                </g>

                                <g class="santa-hat-group" filter="url(#goldGlow)">
                                    <path d="M240,140 C230,110 220,80 250,50 C260,70 280,120 265,140 Z" fill="url(#hatGradient)" stroke="#8B0000" />
                                    <circle cx="250" cy="50" r="12" fill="#F0EAD6" stroke="#D4AF37" />
                                    <path d="M235,135 C245,145 260,145 270,135 L270,150 C260,160 245,160 235,150 Z" fill="#F0EAD6" stroke="#D4AF37" />
                                </g>
                            </svg>
                        </div>
                    </div>
                </section>

                <section class="py-24 px-6 bg-void relative overflow-hidden">
                    <div class="absolute top-0 w-full h-[1px] bg-gradient-to-r from-transparent via-yuleRed/30 to-transparent"></div>
                    <div class="max-w-7xl mx-auto">
                        <div class="text-center mb-16 space-y-4">
                            <i class="fas fa-holly-berry text-gold-500 text-2xl"></i>
                            <h3 class="text-4xl font-display text-white">Presentes do Templo</h3>
                            <p class="text-gray-500 text-sm uppercase tracking-widest">Projetos e Caminhos de Yule</p>
                        </div>

                        <div class="grid md:grid-cols-3 gap-8">
                            <div class="project-card bg-obsidian border border-white/5 p-8 relative group cursor-pointer" onclick="showView('blog-view')">
                                <div class="absolute top-0 right-0 p-6 opacity-10 group-hover:opacity-30 transition duration-500">
                                    <i class="fas fa-book-open text-7xl text-gold-900"></i>
                                </div>
                                <h4 class="text-xl font-display text-gold-400 mb-4 group-hover:text-white transition flex items-center gap-2">O Grim√≥rio <i class="fas fa-star text-[10px] text-yuleRed opacity-50 group-hover:opacity-100 transition"></i></h4>
                                <p class="text-gray-400 text-sm leading-relaxed mb-8 min-h-[80px]">
                                    O cora√ß√£o deste santu√°rio. Artigos profundos e rituais para celebrar a roda do ano.
                                </p>
                                <span class="text-xs font-bold text-gray-500 uppercase tracking-widest group-hover:text-gold-400 transition flex items-center gap-2">Ler Agora <i class="fas fa-arrow-right"></i></span>
                            </div>

                            <a href="https://caminhodatocha.site" target="_blank" class="project-card bg-obsidian border border-white/5 p-8 relative group block">
                                <div class="absolute top-0 right-0 p-6 opacity-10 group-hover:opacity-30 transition duration-500">
                                    <i class="fas fa-fire text-7xl text-yuleRed"></i>
                                </div>
                                <h4 class="text-xl font-display text-gold-400 mb-4 group-hover:text-white transition flex items-center gap-2">Coven do Corvo <i class="fas fa-gift text-[10px] text-yuleRed opacity-50 group-hover:opacity-100 transition"></i></h4>
                                <p class="text-gray-400 text-sm leading-relaxed mb-8 min-h-[80px]">
                                    O maior presente que voc√™ pode se dar: conhecimento estruturado. Um mergulho profundo nos mist√©rios.
                                </p>
                                <span class="text-xs font-bold text-gray-500 uppercase tracking-widest group-hover:text-gold-400 transition flex items-center gap-2">Saber Mais <i class="fas fa-external-link-alt"></i></span>
                            </a>

                            <a href="https://ardanraven.github.io/Calendario/" target="_blank" class="project-card bg-obsidian border border-white/5 p-8 relative group block">
                                <div class="absolute top-0 right-0 p-6 opacity-10 group-hover:opacity-30 transition duration-500">
                                    <i class="fas fa-calendar-alt text-7xl text-gold-900"></i>
                                </div>
                                <h4 class="text-xl font-display text-gold-400 mb-4 group-hover:text-white transition flex items-center gap-2">Calend√°rio Hekatino <i class="fas fa-snowflake text-[10px] text-yuleRed opacity-50 group-hover:opacity-100 transition"></i></h4>
                                <p class="text-gray-400 text-sm leading-relaxed mb-8 min-h-[80px]">
                                    Sincronize-se com os ciclos de inverno. Mapeie os dias sagrados e os rituais espec√≠ficos.
                                </p>
                                <span class="text-xs font-bold text-gray-500 uppercase tracking-widest group-hover:text-gold-400 transition flex items-center gap-2">Acessar <i class="fas fa-external-link-alt"></i></span>
                            </a>
                        </div>
                    </div>
                </section>

                <section class="py-20 px-6 border-t border-gold-900/30 bg-[#080808] text-center relative overflow-hidden">
                     <div class="absolute inset-0 bg-gradient-to-t from-yuleRed/10 to-gold-500/5 blur-[120px] pointer-events-none"></div>
                    <div class="max-w-2xl mx-auto space-y-8 relative z-10">
                        <i class="fas fa-key text-3xl text-gold-500 animate-pulse"></i>
                        <h3 class="text-3xl font-display text-white">Junte-se √† Celebra√ß√£o do Coven</h3>
                        <p class="text-gray-400 font-body leading-relaxed">
                            Neste Yule, alguns segredos s√£o compartilhados apenas entre os iniciados. <br>
                            Se voc√™ possui a chave, adentre o c√≠rculo interno.
                        </p>
                        <button onclick="document.getElementById('login-view').style.display='flex'" class="inline-block border border-gold-900 px-10 py-4 text-gold-400 font-display text-xs font-bold tracking-[0.3em] uppercase hover:bg-yuleRed/80 hover:text-white hover:border-yuleRed transition relative group overflow-hidden">
                            <span class="relative z-10">√Årea Restrita</span>
                             <div class="absolute inset-0 bg-gold-400/10 opacity-0 group-hover:opacity-100 transition"></div>
                        </button>
                    </div>
                </section>
            </div>

            <div id="blog-view" class="view-container hidden max-w-7xl mx-auto pt-10 px-4">
                
                <div id="admin-panel" class="hidden mb-16 p-8 bg-obsidian border border-gold-900/30 rounded-sm relative overflow-hidden">
                    <div class="absolute -right-10 -top-10 text-9xl text-white/5 pointer-events-none"><i class="fas fa-feather"></i></div>
                    <h3 class="text-gold-400 font-display text-xl mb-6 flex items-center gap-2 relative z-10"><i class="fas fa-crown"></i> Painel do Sacerdote (Edi√ß√£o de Yule)</h3>
                    
                    <div class="grid lg:grid-cols-2 gap-10 relative z-10">
                        <form id="create-post-form" class="space-y-4">
                            <input type="text" id="post-title" class="input-luxe w-full p-3 font-display text-lg" placeholder="T√≠tulo do Ritual" required>
                            <input type="url" id="post-cover-image" class="input-luxe w-full p-3 font-body text-sm" placeholder="Link da Imagem (https://...)" required>
                            <div class="relative">
                                <textarea id="post-content" rows="6" class="input-luxe w-full p-3 font-body text-sm" placeholder="Escreva os segredos..." required></textarea>
                                <button type="button" id="format-create-btn" class="absolute bottom-2 right-2 text-[10px] bg-black border border-gold-900 text-gold-400 px-3 py-1 uppercase hover:bg-gold-900 transition"><i class="fas fa-magic mr-1"></i> IA</button>
                            </div>
                            <div class="grid grid-cols-2 gap-4">
                                <select id="post-access" class="input-luxe w-full p-2 text-sm bg-black cursor-pointer"><option value="aberto">üîì P√∫blico</option><option value="pago">üîê Membros</option></select>
                                <select id="post-section" class="input-luxe w-full p-2 text-sm bg-black cursor-pointer" required><option value="">Carregando...</option></select>
                            </div>
                            <div class="grid grid-cols-2 gap-4">
                                <input type="text" id="post-attachment-name" placeholder="Nome do Anexo" class="input-luxe w-full p-2 text-sm">
                                <input type="url" id="post-attachment-link" placeholder="Link do Anexo" class="input-luxe w-full p-2 text-sm">
                            </div>
                            <button type="submit" class="w-full bg-gold-900/40 border border-gold-500/50 text-gold-400 py-3 font-bold uppercase text-xs tracking-widest hover:bg-gold-500 hover:text-black transition">Publicar no Grim√≥rio</button>
                            <p id="post-status" class="text-center text-xs h-4 text-gold-500"></p>
                        </form>

                        <div class="space-y-6">
                            <div class="bg-black/40 p-5 border border-white/5">
                                <h4 class="text-gray-400 text-xs uppercase tracking-widest mb-3"><i class="fas fa-user-plus mr-2"></i>Novo Assinante</h4>
                                <form id="create-account-form" class="flex gap-2 flex-col">
                                    <input type="email" id="new-email" placeholder="Email do Aluno" class="input-luxe p-2 text-sm">
                                    <input type="password" id="new-password" placeholder="Senha Provis√≥ria" class="input-luxe p-2 text-sm">
                                    <select id="account-validity" class="input-luxe p-2 text-sm bg-black"><option value="1">1 M√™s</option><option value="3">3 Meses</option></select>
                                    <button type="submit" class="border border-white/20 text-white py-2 text-xs uppercase hover:bg-white hover:text-black transition">Criar Acesso</button>
                                    <p id="account-status" class="text-xs h-4"></p>
                                </form>
                            </div>
                            <div class="grid grid-cols-2 gap-4">
                                <div class="bg-black/40 p-4 border border-white/5">
                                    <h4 class="text-gray-400 text-xs uppercase tracking-widest mb-3">M√≥dulos</h4>
                                    <form id="create-section-form" class="flex gap-2 mb-2">
                                        <input type="text" id="section-name" placeholder="Nome" class="input-luxe w-full p-1 text-xs">
                                        <button type="submit" class="text-gold-400 hover:text-white"><i class="fas fa-plus"></i></button>
                                    </form>
                                    <div id="sections-list-admin" class="max-h-24 overflow-y-auto text-xs text-gray-500 custom-scrollbar"></div>
                                </div>
                                <div class="bg-black/40 p-4 border border-white/5">
                                    <h4 class="text-gray-400 text-xs uppercase tracking-widest mb-3">Alunos</h4>
                                    <div id="students-list-admin" class="max-h-32 overflow-y-auto text-xs text-gray-500 space-y-1 custom-scrollbar"></div>
                                </div>
                            </div>
                            <div class="bg-black/40 p-2 border border-white/5">
                                <input type="password" id="gemini-api-key" placeholder="Cole a API Key do Gemini aqui" class="input-luxe w-full p-1 text-[10px]">
                            </div>
                        </div>
                    </div>
                </div>

                <div class="flex justify-center md:justify-end mb-10">
                    <div class="relative">
                        <select id="section-filter" class="appearance-none bg-transparent text-gold-400 border-b border-white/20 py-2 pr-8 pl-4 text-right focus:outline-none cursor-pointer text-lg font-display uppercase tracking-wider hover:border-gold-500 transition">
                            <option value="todos" class="bg-black">Todos os Mist√©rios</option>
                        </select>
                        <i class="fas fa-chevron-down absolute right-0 top-3 text-gold-500 text-xs pointer-events-none"></i>
                    </div>
                </div>

                <div id="pago-section" class="hidden mb-16 relative">
                    <div class="flex items-center justify-center gap-4 mb-8">
                        <span class="h-[1px] w-12 bg-gold-900"></span>
                        <h2 class="text-gold-500 font-display text-xl tracking-[0.3em] uppercase flex items-center gap-2"><i class="fas fa-lock text-sm"></i>Conhecimento Oculto <i class="fas fa-holly-berry text-yuleRed text-sm opacity-70"></i></h2>
                        <span class="h-[1px] w-12 bg-gold-900"></span>
                    </div>
                    <div id="posts-list-pago" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8"></div>
                    <p id="empty-pago" class="text-center text-gray-600 text-sm hidden italic">O sil√™ncio de inverno reina nesta se√ß√£o.</p>
                </div>

                <div class="mb-20">
                    <div class="flex items-center justify-center gap-4 mb-8">
                        <span class="h-[1px] w-12 bg-white/10"></span>
                        <h2 class="text-gray-400 font-display text-lg tracking-[0.3em] uppercase flex items-center gap-2"><i class="fas fa-book-open text-sm"></i>Pergaminhos Abertos <i class="fas fa-snowflake text-white text-sm opacity-50"></i></h2>
                        <span class="h-[1px] w-12 bg-white/10"></span>
                    </div>
                    <div id="posts-list-aberto" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8"></div>
                    <p id="empty-aberto" class="text-center text-gray-600 text-sm hidden italic">Nenhum registro encontrado nas neves do tempo.</p>
                </div>
            </div>

            <div id="sobre-view" class="view-container hidden max-w-5xl mx-auto pt-10 px-4">
                <div class="glass-dark p-8 md:p-16 border-t border-gold-900/50 relative overflow-hidden">
                    <div class="absolute -top-20 -right-20 w-60 h-60 bg-yuleRed/10 rounded-full blur-3xl"></div>
                    
                    <div class="flex flex-col md:flex-row gap-12 items-center relative z-10">
                        <div class="w-full md:w-2/5 relative group">
                            <div class="absolute inset-0 border border-gold-500/20 translate-x-3 translate-y-3 group-hover:translate-x-2 group-hover:translate-y-2 transition duration-500"></div>
                            <img src="https://i.ibb.co/0ymRCF5C/2-DACB7-CC-CE28-4383-BD50-DEB2-C7-A38721.png" class="w-full grayscale hover:grayscale-0 transition duration-700 shadow-2xl relative z-10">
                            <div class="absolute -bottom-5 -left-5 text-3xl text-gold-500 opacity-50 rotate-12"><i class="fas fa-holly-berry text-yuleRed"></i></div>
                        </div>
                        <div class="w-full md:w-3/5 text-gray-300 font-body leading-relaxed space-y-6 text-lg text-justify">
                            <div>
                                <h2 class="text-4xl font-display text-white mb-1 flex items-center gap-3">Leonardo <i class="fas fa-star-of-life text-gold-500 text-xl"></i></h2>
                                <p class="text-gold-500 text-xs uppercase tracking-[0.4em]">Sacerdote de Hekate</p>
                            </div>
                            <p>
                                <span class="text-4xl float-left mr-2 text-gold-600 font-display">N</span>este per√≠odo de Yule, refletimos sobre as encruzilhadas. Minha vida foi dedicada a entender as escolhas que fazemos nas sombras, guiado pela chama da Deusa que renasce.
                            </p>
                            <p>
                                O projeto <strong>O Coven do Corvo</strong> √© meu presente para a comunidade. Aqui, a magia n√£o √© teoria; √© viv√™ncia. Compartilho minha devo√ß√£o e a sabedoria das chaves.
                            </p>
                            <div class="pt-6 border-t border-white/5 flex gap-4 text-2xl text-gold-400">
                                <a href="#" class="hover:text-white transition"><i class="fab fa-instagram"></i></a>
                                <a href="#" class="hover:text-white transition"><i class="fab fa-youtube"></i></a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        </main>

        <footer class="bg-black py-12 text-center border-t border-gold-900/20 relative z-10 overflow-hidden">
            <div class="absolute inset-0 bg-yuleRed/5 pointer-events-none"></div>
            <i class="fas fa-crow text-gold-900 text-2xl mb-4 animate-pulse relative z-10"></i>
            <p class="text-gray-600 text-[10px] uppercase tracking-[0.2em] mb-2 relative z-10">¬© 2025 Coven do Corvo | Feliz Yule</p>
            <p class="text-gray-800 text-[10px] relative z-10">Desenvolvido nas Sombras do Inverno</p>
        </footer>

        <div id="login-view" class="view-container hidden fixed inset-0 z-50 bg-black/95 backdrop-blur-sm flex items-center justify-center p-4">
            <div class="w-full max-w-sm relative bg-obsidian p-10 border border-gold-900/30 shadow-[0_0_50px_rgba(139,0,0,0.2)]">
                <button id="close-login-btn" class="absolute top-4 right-4 text-gray-500 hover:text-white transition"><i class="fas fa-times"></i></button>
                <div class="text-center mb-10">
                    <i class="fas fa-key text-gold-500 text-2xl mb-4"></i>
                    <h2 class="text-2xl font-display text-white tracking-widest flex justify-center items-center gap-2">ACESSO <i class="fas fa-holly-berry text-yuleRed text-sm"></i></h2>
                    <p class="text-[10px] text-gray-500 uppercase tracking-widest mt-2">√Årea do Coven do Corvo</p>
                </div>
                <form id="login-form" class="space-y-6">
                    <div class="group">
                        <input type="email" id="login-email" placeholder="EMAIL" class="w-full bg-transparent border-b border-gray-700 p-3 text-center text-white focus:border-gold-400 outline-none transition font-display tracking-wider">
                    </div>
                    <div class="group">
                        <input type="password" id="login-password" placeholder="SENHA" class="w-full bg-transparent border-b border-gray-700 p-3 text-center text-white focus:border-gold-400 outline-none transition font-display tracking-wider">
                    </div>
                    <button type="submit" class="w-full border border-gold-900 text-gold-400 py-4 uppercase text-xs tracking-[0.3em] hover:bg-yuleRed/80 hover:text-white hover:border-yuleRed transition font-bold mt-4">Entrar</button>
                </form>
                <p id="login-error" class="text-center text-red-500 text-xs mt-6 font-display tracking-wider"></p>
            </div>
        </div>

        <div id="post-view" class="view-container hidden fixed inset-0 z-[60] bg-[#050505] overflow-y-auto custom-scrollbar">
            <div class="max-w-4xl mx-auto min-h-screen bg-obsidian border-x border-white/5 relative shadow-2xl">
                <div class="sticky top-0 z-20 bg-obsidian/95 backdrop-blur border-b border-white/5 p-4 flex justify-between items-center h-16 shadow-lg">
                    <button id="back-to-posts-btn" class="text-gold-400 text-xs uppercase tracking-[0.2em] hover:text-white transition flex items-center gap-2 group">
                        <i class="fas fa-arrow-left group-hover:-translate-x-1 transition"></i> Voltar
                    </button>
                    <div class="admin-only-controls hidden gap-4">
                        <button id="post-view-edit-btn" class="text-gray-500 hover:text-white transition"><i class="fas fa-pen"></i></button>
                        <button id="post-view-delete-btn" class="text-gray-500 hover:text-red-500 transition"><i class="fas fa-trash"></i></button>
                    </div>
                </div>

                <div class="p-6 md:p-16 pb-32">
                    <h1 id="post-view-title" class="text-3xl md:text-5xl font-display text-white text-center mb-6 leading-tight"></h1>
                    
                    <div class="flex justify-center items-center gap-6 text-[10px] text-gray-500 uppercase tracking-widest mb-12 border-b border-white/5 pb-6">
                        <span><i class="fas fa-eye text-gold-900 mr-2"></i><span id="post-view-count">0</span> Leituras</span>
                        <i class="fas fa-circle text-[3px] text-gold-500"></i>
                        <span>Coven do Corvo</span>
                    </div>

                    <div class="flex justify-center mb-12">
                         <div id="audio-controls" class="inline-flex items-center gap-4 px-6 py-2 border border-gold-900/30 rounded-full cursor-pointer hover:border-gold-400/50 transition group bg-black/50">
                            <button id="btn-speak" class="flex items-center gap-3 text-gold-500 group-hover:text-gold-300 text-xs uppercase font-bold tracking-widest">
                                <i id="btn-speak-icon" class="fas fa-play text-[10px]"></i> <span id="btn-speak-text">Ouvir o Chamado</span>
                            </button>
                            <button id="btn-stop-speak" class="hidden text-red-800 hover:text-red-500 transition"><i class="fas fa-stop"></i></button>
                            <audio id="gemini-audio-player" class="hidden"></audio>
                        </div>
                    </div>

                    <div class="relative group mb-12">
                        <div class="absolute inset-0 bg-gold-500/10 blur-xl opacity-0 group-hover:opacity-100 transition duration-1000"></div>
                        <img id="post-view-cover-image" class="w-full h-auto max-h-[600px] object-cover border-y border-white/10 grayscale group-hover:grayscale-0 transition duration-1000 relative z-10">
                    </div>

                    <div id="post-view-content" class="prose prose-invert prose-lg max-w-none font-body text-gray-300 leading-loose text-justify"></div>

                    <div id="post-view-attachment-container" class="hidden mt-20 pt-10 border-t border-gold-900/30 text-center">
                        <p class="text-[10px] text-gold-600 uppercase tracking-widest mb-4">Conte√∫do Adicional</p>
                        <a id="post-view-attachment" href="#" target="_blank" class="inline-flex items-center gap-3 border border-gold-900 text-gold-400 px-8 py-3 text-xs uppercase tracking-widest hover:bg-gold-400 hover:text-black transition">
                            <i class="fas fa-download"></i> Baixar Material
                        </a>
                    </div>
                </div>
            </div>
        </div>

        <div id="edit-post-view" class="view-container hidden fixed inset-0 z-[70] bg-black p-4 overflow-y-auto">
             <div class="max-w-2xl mx-auto mt-20 bg-obsidian p-8 border border-white/10 shadow-2xl">
                <h2 class="text-xl font-display text-white mb-8 border-b border-white/10 pb-4">Editar Pergaminho</h2>
                <form id="edit-post-form" class="space-y-6">
                    <input type="hidden" id="edit-post-id">
                    <input type="text" id="edit-post-title" class="input-luxe w-full p-3 font-display" required>
                    <input type="url" id="edit-post-cover-image" class="input-luxe w-full p-3" required>
                    <div class="relative">
                        <textarea id="edit-post-content" rows="10" class="input-luxe w-full p-3" required></textarea>
                        <button type="button" id="format-edit-btn" class="absolute bottom-3 right-3 text-gold-400 text-[10px] uppercase border border-gold-900 px-2 py-1 bg-black">IA</button>
                    </div>
                     <div class="grid grid-cols-2 gap-6">
                        <input type="text" id="edit-post-attachment-name" class="input-luxe w-full p-3">
                        <input type="url" id="edit-post-attachment-link" class="input-luxe w-full p-3">
                    </div>
                    <div class="grid grid-cols-2 gap-6">
                        <select id="edit-post-access" class="input-luxe w-full p-3 bg-black"><option value="pago">Pago</option><option value="aberto">Aberto</option></select>
                        <select id="edit-post-section" class="input-luxe w-full p-3 bg-black"></select>
                    </div>
                    <div class="flex gap-4 mt-8">
                        <button type="submit" class="flex-1 bg-gold-900 text-white py-3 text-xs uppercase tracking-widest hover:bg-gold-600 transition">Salvar</button>
                        <button type="button" id="cancel-edit-btn" class="flex-1 bg-gray-800 text-white py-3 text-xs uppercase tracking-widest hover:bg-gray-700 transition">Cancelar</button>
                    </div>
                    <p id="edit-post-status" class="text-center mt-4 text-xs text-gold-500"></p>
                </form>
             </div>
        </div>

        <div id="manage-student-modal" class="hidden fixed inset-0 z-[80] bg-black/90 flex items-center justify-center p-4">
            <div class="bg-obsidian border border-white/10 p-8 w-full max-w-md shadow-2xl">
                <div class="flex justify-between mb-6">
                    <div>
                        <span class="text-[10px] text-gray-500 uppercase tracking-widest block">Gerenciando</span>
                        <span id="student-modal-email" class="text-gold-400 font-display text-lg"></span>
                    </div>
                    <button id="close-student-modal-btn"><i class="fas fa-times text-gray-500 hover:text-white transition"></i></button>
                </div>
                <input type="hidden" id="student-modal-id">
                <div id="student-modal-sections-list" class="space-y-3 mb-8 max-h-60 overflow-y-auto custom-scrollbar bg-black/50 p-4 border border-white/5"></div>
                <button id="save-student-sections-btn" class="w-full bg-gold-900 text-white py-3 text-xs uppercase tracking-widest hover:bg-gold-500 hover:text-black transition font-bold">Salvar Permiss√µes</button>
                <p id="student-modal-status" class="text-center text-xs mt-4 h-4"></p>
            </div>
        </div>

        <div id="delete-confirm-modal" class="hidden fixed inset-0 z-[90] bg-black/95 flex items-center justify-center">
            <div class="text-center p-10 border border-red-900/30 bg-obsidian shadow-[0_0_50px_rgba(255,0,0,0.1)]">
                <i class="fas fa-exclamation-triangle text-red-900 text-4xl mb-6"></i>
                <h2 id="delete-modal-title" class="text-xl font-display text-white mb-2">Tem certeza?</h2>
                <p class="text-gray-500 text-xs uppercase tracking-widest mb-8">O conhecimento ser√° perdido para sempre.</p>
                <div class="flex justify-center gap-6">
                    <button id="confirm-delete-btn" class="bg-red-900/50 text-red-100 border border-red-900 px-8 py-3 text-xs uppercase hover:bg-red-900 transition">Excluir</button>
                    <button id="cancel-delete-btn" class="bg-gray-800 text-white px-8 py-3 text-xs uppercase hover:bg-gray-700 transition">Cancelar</button>
                </div>
            </div>
        </div>

    </div> <script src="https://player.vimeo.com/api/player.js"></script>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, addDoc, onSnapshot, doc, getDoc, setDoc, query, deleteDoc, updateDoc, setLogLevel, orderBy, increment } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // === CONFIGURA√á√ÉO FIREBASE ===
        const firebaseConfig = {
          apiKey: "AIzaSyBQXn_dPUivGjfGrWvMwysa-IDX8eXNbCA",
          authDomain: "corvo-4f7e7.firebaseapp.com",
          projectId: "corvo-4f7e7",
          storageBucket: "corvo-4f7e7.firebasestorage.app",
          messagingSenderId: "793120208869",
          appId: "1:793120208869:web:378c37a33c729ff1a6e10c",
          measurementId: "G-V8LBRHPNKT"
        };
        const ADMIN_UID = "9yeLL3aKVXVHKiBNKI3yFiCPMIE3"; 
        const HARDCODED_API_KEY = "AIzaSyA2m-CD-RJOiac90q7p4iql7fYyhlnW1xY"; 

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // === VARI√ÅVEIS ===
        let currentUser = null; 
        let currentUserPermissions = []; 
        let itemToDelete = { id: null, type: null }; 
        let allPosts = []; 
        let allSections = []; 
        let allStudents = []; 

        // === REFER√äNCIAS ===
        const appRoot = document.getElementById('app-root');
        const introSection = document.getElementById('intro-sequence');
        const loadingSpinner = document.getElementById('loading-spinner');
        const allViews = document.querySelectorAll('.view-container');
        
        // --- INTRO SAFETY ---
        window.forceOpenSite = function() {
            gsap.to(introSection, { opacity: 0, duration: 1, onComplete: () => {
                introSection.style.display = 'none';
                appRoot.style.display = 'block';
                gsap.to(appRoot, { opacity: 1, duration: 1 });
            }});
        };

        window.onload = function() {
            // Failsafe timer
            setTimeout(() => { if(introSection.style.display !== 'none') window.forceOpenSite(); }, 8000); 
            // Normal timer
            setTimeout(() => { window.forceOpenSite(); }, 7500);
        };

        // === NAVEGA√á√ÉO ===
        function showView(viewId) {
            allViews.forEach(view => {
                if (view.classList.contains('fixed')) {
                    if(view.id === viewId) view.style.display = 'flex';
                    else if(!viewId.includes('modal') && !['manage-student-modal','delete-confirm-modal'].includes(view.id)) view.style.display = 'none';
                } else {
                    view.style.display = view.id === viewId ? 'block' : 'none';
                }
            });
            if(!viewId.includes('modal') && viewId !== 'login-view') window.scrollTo(0,0);
            document.getElementById('mobile-menu').classList.add('hidden');
        }

        document.querySelectorAll('.internal-link').forEach(btn => {
            btn.addEventListener('click', (e) => {
                const target = e.currentTarget.dataset.view;
                if(target) showView(target);
                stopSpeaking();
            });
        });

        document.getElementById('mobile-menu-btn').addEventListener('click', () => {
            document.getElementById('mobile-menu').classList.remove('hidden');
        });

        // === AUTH ===
        const loginBtn = document.getElementById('login-btn');
        const logoutBtn = document.getElementById('logout-btn');
        const userInfo = document.getElementById('user-info');
        const userEmailSpan = document.getElementById('user-email');
        const adminPanel = document.getElementById('admin-panel');
        const pagoSection = document.getElementById('pago-section');
        const adminControls = document.querySelectorAll('.admin-only-controls');

        onAuthStateChanged(auth, async (user) => {
            currentUserPermissions = [];
            if (user) {
                const isAdmin = user.uid === ADMIN_UID;
                const userDoc = await getDoc(doc(db, "users", user.uid));
                
                if (!isAdmin) {
                    if (userDoc.exists()) {
                        const expires = userDoc.data().expiresAt.toDate();
                        if (new Date() > expires) { await signOut(auth); return; }
                        currentUserPermissions = userDoc.data().accessibleSections || [];
                    } else { await signOut(auth); return; }
                }

                currentUser = user;
                userInfo.style.display = 'flex';
                userEmailSpan.textContent = user.email;
                loginBtn.style.display = 'none';
                pagoSection.style.display = 'block';
                
                if (isAdmin) {
                    adminPanel.style.display = 'block';
                    adminControls.forEach(el => { el.style.display = 'flex'; el.classList.remove('hidden'); });
                    fetchStudents();
                } else {
                    adminPanel.style.display = 'none';
                    adminControls.forEach(el => el.style.display = 'none');
                }
                if(document.getElementById('login-view').style.display === 'flex') showView('blog-view');

            } else {
                currentUser = null;
                userInfo.style.display = 'none';
                loginBtn.style.display = 'block';
                adminPanel.style.display = 'none';
                pagoSection.style.display = 'none';
                adminControls.forEach(el => el.style.display = 'none');
            }
            fetchSections();
            fetchPosts();
        });

        document.getElementById('login-form').addEventListener('submit', (e) => {
            e.preventDefault();
            const email = document.getElementById('login-email').value;
            const pass = document.getElementById('login-password').value;
            signInWithEmailAndPassword(auth, email, pass).catch(err => {
                document.getElementById('login-error').textContent = "Credenciais incorretas.";
            });
        });
        logoutBtn.addEventListener('click', () => signOut(auth));
        loginBtn.addEventListener('click', () => showView('login-view'));
        document.getElementById('close-login-btn').addEventListener('click', () => showView('home-view'));

        // === ADMIN FUNCTIONS ===
        
        // 1. Sections
        const sectionFilter = document.getElementById('section-filter');
        const postSectionSelect = document.getElementById('post-section');
        const editPostSectionSelect = document.getElementById('edit-post-section');
        const sectionsListAdmin = document.getElementById('sections-list-admin');

        function fetchSections() {
            const q = query(collection(db, "sections"), orderBy("name"));
            onSnapshot(q, (snap) => {
                allSections = [];
                sectionFilter.innerHTML = '<option value="todos" class="bg-black">Todos os Mist√©rios</option>';
                postSectionSelect.innerHTML = '<option value="" class="bg-black">Selecione o M√≥dulo</option>';
                editPostSectionSelect.innerHTML = '<option value="" class="bg-black">Selecione o M√≥dulo</option>';
                sectionsListAdmin.innerHTML = '';

                snap.forEach(d => {
                    const sec = { id: d.id, ...d.data() };
                    allSections.push(sec);
                    sectionFilter.add(new Option(sec.name, sec.id));
                    postSectionSelect.add(new Option(sec.name, sec.id));
                    editPostSectionSelect.add(new Option(sec.name, sec.id));
                    
                    const div = document.createElement('div');
                    div.className = "flex justify-between items-center p-2 hover:bg-white/5 rounded border-b border-white/5";
                    div.innerHTML = `<span>${sec.name}</span> <button class="delete-sec-btn text-red-500 hover:text-red-300" data-id="${sec.id}"><i class="fas fa-times"></i></button>`;
                    sectionsListAdmin.appendChild(div);
                });
            });
        }
        
        document.getElementById('create-section-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const name = document.getElementById('section-name').value;
            if(name) { await addDoc(collection(db, "sections"), {name, createdAt: new Date()}); document.getElementById('create-section-form').reset(); }
        });

        // 2. Students
        const studentsListAdmin = document.getElementById('students-list-admin');
        function fetchStudents() {
            onSnapshot(query(collection(db, "users")), (snap) => {
                allStudents = [];
                studentsListAdmin.innerHTML = '';
                snap.forEach(d => {
                    if(d.id === ADMIN_UID) return;
                    const st = { id: d.id, ...d.data() };
                    allStudents.push(st);
                    const div = document.createElement('div');
                    div.className = "flex justify-between p-2 border-b border-white/5 hover:bg-white/5";
                    div.innerHTML = `<span class="truncate w-32">${st.email}</span><button class="manage-student-btn text-gold-400" data-id="${st.id}"><i class="fas fa-cog"></i></button>`;
                    studentsListAdmin.appendChild(div);
                });
            });
        }
        
        document.getElementById('create-account-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const email = document.getElementById('new-email').value;
            const pass = document.getElementById('new-password').value;
            const months = parseInt(document.getElementById('account-validity').value);
            const status = document.getElementById('account-status');
            status.textContent = "Gerando...";
            try {
                const cred = await createUserWithEmailAndPassword(auth, email, pass);
                const exp = new Date(); exp.setMonth(exp.getMonth() + months);
                await setDoc(doc(db, "users", cred.user.uid), { email, createdAt: new Date(), expiresAt: exp, accessibleSections: [] });
                status.textContent = "Acesso Criado!"; status.className = "text-green-400 text-xs";
                document.getElementById('create-account-form').reset();
            } catch(e) { status.textContent = "Erro: " + e.code; status.className = "text-red-400 text-xs"; }
        });

        // 3. Posts
        const createPostForm = document.getElementById('create-post-form');
        const postStatus = document.getElementById('post-status');

        createPostForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            postStatus.textContent = "Enviando ao Grim√≥rio...";
            const secSelect = document.getElementById('post-section');
            const secName = secSelect.options[secSelect.selectedIndex].text;
            
            try {
                await addDoc(collection(db, "posts"), {
                    title: document.getElementById('post-title').value,
                    coverImage: document.getElementById('post-cover-image').value,
                    content: document.getElementById('post-content').value,
                    attachmentName: document.getElementById('post-attachment-name').value || null,
                    attachmentURL: document.getElementById('post-attachment-link').value || null,
                    access: document.getElementById('post-access').value,
                    sectionId: secSelect.value,
                    sectionName: secName,
                    createdAt: new Date(),
                    viewCount: 0
                });
                postStatus.textContent = "Publicado!"; createPostForm.reset();
            } catch(e) { postStatus.textContent = "Falha no ritual."; }
        });

        const postsListPago = document.getElementById('posts-list-pago');
        const postsListAberto = document.getElementById('posts-list-aberto');

        function fetchPosts() {
            onSnapshot(query(collection(db, "posts"), orderBy("createdAt", "desc")), (snap) => {
                allPosts = [];
                snap.forEach(d => allPosts.push({ id: d.id, ...d.data() }));
                renderPosts(sectionFilter.value);
            });
        }

        function renderPosts(filterId) {
            postsListPago.innerHTML = ''; postsListAberto.innerHTML = '';
            let cPago = 0; let cAberto = 0;
            const filtered = (filterId === 'todos') ? allPosts : allPosts.filter(p => p.sectionId === filterId);

            filtered.forEach(p => {
                const card = document.createElement('div');
                card.className = "project-card bg-obsidian border border-white/5 cursor-pointer h-[420px] flex flex-col group relative overflow-hidden";
                card.dataset.id = p.id;

                let adminBtns = '';
                if(currentUser && currentUser.uid === ADMIN_UID) {
                    adminBtns = `<div class="absolute top-2 right-2 z-20 flex gap-2"><button class="edit-btn bg-black/80 p-2 rounded text-gold-400 hover:text-white" data-id="${p.id}"><i class="fas fa-pen"></i></button><button class="del-btn bg-black/80 p-2 rounded text-red-500 hover:text-red-300" data-id="${p.id}"><i class="fas fa-trash"></i></button></div>`;
                }

                card.innerHTML = `
                    ${adminBtns}
                    <div class="h-52 overflow-hidden relative">
                        <img src="${p.coverImage}" class="w-full h-full object-cover opacity-80 group-hover:opacity-100 transition duration-700 transform group-hover:scale-110 filter grayscale group-hover:grayscale-0">
                        <div class="absolute inset-0 bg-gradient-to-t from-obsidian to-transparent opacity-80"></div>
                        <span class="absolute top-3 left-3 bg-black/80 text-gold-400 text-[9px] px-2 py-1 uppercase tracking-widest border border-gold-900/30">${p.sectionName || 'Geral'}</span>
                    </div>
                    <div class="p-6 flex flex-col flex-grow relative">
                        <h3 class="text-white font-display text-lg leading-tight mb-3 group-hover:text-gold-400 transition line-clamp-2">${p.title}</h3>
                        <p class="text-gray-500 text-xs line-clamp-3 mb-6 font-body font-light leading-relaxed">${p.content.replace(/[#*_]/g, '').substring(0, 100)}...</p>
                        <div class="mt-auto flex justify-between border-t border-white/5 pt-4 items-center">
                             <span class="text-[10px] text-gray-600 uppercase tracking-wider"><i class="fas fa-eye mr-1"></i> ${p.viewCount||0}</span>
                             <span class="text-[10px] text-gold-500 uppercase tracking-[0.2em] group-hover:translate-x-1 transition flex items-center gap-1">Ler <i class="fas fa-chevron-right text-[8px]"></i></span>
                        </div>
                    </div>
                `;

                if(p.access === 'aberto') { postsListAberto.appendChild(card); cAberto++; }
                else if(p.access === 'pago') {
                    const allowed = (currentUser && currentUser.uid === ADMIN_UID) || (currentUser && currentUserPermissions.includes(p.sectionId));
                    if(allowed) { postsListPago.appendChild(card); cPago++; }
                }
            });

            document.getElementById('empty-aberto').style.display = cAberto === 0 ? 'block' : 'none';
            document.getElementById('empty-pago').style.display = (cPago === 0 && document.getElementById('pago-section').style.display === 'block') ? 'block' : 'none';
        }

        sectionFilter.addEventListener('change', (e) => renderPosts(e.target.value));

        // === VIEW POST ===
        const postViewTitle = document.getElementById('post-view-title');
        const postViewContent = document.getElementById('post-view-content');
        const postViewCover = document.getElementById('post-view-cover-image');
        const postViewCount = document.getElementById('post-view-count');
        const postViewAttachContainer = document.getElementById('post-view-attachment-container');
        const postViewAttachLink = document.getElementById('post-view-attachment');

        async function openPost(id) {
            loadingSpinner.classList.remove('hidden');
            const ref = doc(db, "posts", id);
            const snap = await getDoc(ref);
            
            if(snap.exists()) {
                const p = snap.data();
                if(p.access === 'pago') {
                    const allowed = (currentUser && currentUser.uid === ADMIN_UID) || (currentUser && currentUserPermissions.includes(p.sectionId));
                    if(!allowed) { 
                        loadingSpinner.classList.add('hidden'); 
                        alert("Este conhecimento est√° selado."); return; 
                    }
                }

                await updateDoc(ref, { viewCount: increment(1) });
                
                postViewTitle.textContent = p.title;
                postViewCount.textContent = (p.viewCount || 0) + 1;
                postViewCover.src = p.coverImage;
                postViewContent.innerHTML = formatText(p.content);
                
                if(p.attachmentURL) {
                    postViewAttachLink.href = p.attachmentURL;
                    postViewAttachContainer.classList.remove('hidden');
                } else {
                    postViewAttachContainer.classList.add('hidden');
                }

                document.getElementById('post-view-edit-btn').onclick = () => openEdit(id);
                document.getElementById('post-view-delete-btn').onclick = () => confirmDel(id, 'post');

                stopSpeaking();
                showView('post-view');
            }
            loadingSpinner.classList.add('hidden');
        }

        function formatText(txt) {
            if(!txt) return '';
            let t = txt.replace(/</g, "&lt;").replace(/>/g, "&gt;");
            t = t.replace(/!\[(.*?)\]\((.*?)\)/g, `<div class="my-10"><img src="$2" class="w-full rounded-sm border border-gold-900/30 shadow-lg"><p class="text-center text-[10px] text-gray-500 mt-2 uppercase tracking-widest">$1</p></div>`);
            t = t.replace(/\*\*(.*?)\*\*/g, '<strong class="text-gold-400 font-bold">$1</strong>');
            t = t.replace(/##(.*?)##/g, '<span class="text-purple-300 italic border-b border-purple-900/50">$1</span>');
            t = t.replace(/^### (.*$)/gim, '<h3 class="text-2xl text-white font-display mt-8 mb-4 border-l-2 border-gold-500 pl-4">$1</h3>');
            return t.replace(/\n/g, '<br>');
        }

        // === EDIT & DELETE ===
        const editPostForm = document.getElementById('edit-post-form');
        async function openEdit(id) {
            const snap = await getDoc(doc(db, "posts", id));
            if(snap.exists()) {
                const p = snap.data();
                document.getElementById('edit-post-id').value = id;
                document.getElementById('edit-post-title').value = p.title;
                document.getElementById('edit-post-cover-image').value = p.coverImage;
                document.getElementById('edit-post-content').value = p.content;
                document.getElementById('edit-post-attachment-name').value = p.attachmentName||'';
                document.getElementById('edit-post-attachment-link').value = p.attachmentURL||'';
                document.getElementById('edit-post-access').value = p.access;
                document.getElementById('edit-post-section').value = p.sectionId;
                showView('edit-post-view');
            }
        }

        editPostForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const id = document.getElementById('edit-post-id').value;
            const secSelect = document.getElementById('edit-post-section');
            const secName = secSelect.options[secSelect.selectedIndex].text;
            
            await updateDoc(doc(db, "posts", id), {
                title: document.getElementById('edit-post-title').value,
                coverImage: document.getElementById('edit-post-cover-image').value,
                content: document.getElementById('edit-post-content').value,
                attachmentName: document.getElementById('edit-post-attachment-name').value,
                attachmentURL: document.getElementById('edit-post-attachment-link').value,
                access: document.getElementById('edit-post-access').value,
                sectionId: secSelect.value,
                sectionName: secName
            });
            openPost(id); 
        });

        document.getElementById('cancel-edit-btn').addEventListener('click', () => {
             if(document.getElementById('post-view').style.display === 'block') showView('post-view');
             else showView('blog-view');
        });

        function confirmDel(id, type) {
            itemToDelete = {id, type};
            document.getElementById('delete-confirm-modal').style.display = 'flex';
        }
        document.getElementById('confirm-delete-btn').addEventListener('click', async () => {
            if(itemToDelete.type === 'post') {
                await deleteDoc(doc(db, "posts", itemToDelete.id));
                showView('blog-view');
            } else if (itemToDelete.type === 'section') {
                await deleteDoc(doc(db, "sections", itemToDelete.id));
            }
            document.getElementById('delete-confirm-modal').style.display = 'none';
        });
        document.getElementById('cancel-delete-btn').addEventListener('click', () => {
            document.getElementById('delete-confirm-modal').style.display = 'none';
        });

        // === GLOBAL LISTENERS ===
        appRoot.addEventListener('click', (e) => {
            const card = e.target.closest('[data-id]');
            // Open post from card
            if(card && card.parentElement.id.includes('posts-list') && !e.target.closest('button')) {
                openPost(card.dataset.id);
            }
            
            // Buttons inside list
            if(e.target.closest('.edit-btn')) openEdit(e.target.closest('.edit-btn').dataset.id);
            if(e.target.closest('.del-btn')) confirmDel(e.target.closest('.del-btn').dataset.id, 'post');
            if(e.target.closest('.delete-sec-btn')) confirmDel(e.target.closest('.delete-sec-btn').dataset.id, 'section');
            
            // Student
            if(e.target.closest('.manage-student-btn')) {
                openManageStudent(e.target.closest('.manage-student-btn').dataset.id);
            }
        });

        const manageModal = document.getElementById('manage-student-modal');
        function openManageStudent(sid) {
            const st = allStudents.find(s => s.id === sid);
            if(!st) return;
            document.getElementById('student-modal-email').textContent = st.email;
            document.getElementById('student-modal-id').value = sid;
            const list = document.getElementById('student-modal-sections-list');
            list.innerHTML = '';
            
            allSections.forEach(sec => {
                const checked = st.accessibleSections && st.accessibleSections.includes(sec.id);
                const label = document.createElement('label');
                label.className = "flex items-center gap-3 text-gray-300 text-sm p-2 hover:bg-white/5 cursor-pointer border-b border-white/5";
                label.innerHTML = `<input type="checkbox" value="${sec.id}" ${checked?'checked':''} class="accent-gold-400 w-4 h-4"> ${sec.name}`;
                list.appendChild(label);
            });
            manageModal.style.display = 'flex';
        }
        
        document.getElementById('save-student-sections-btn').addEventListener('click', async () => {
            const sid = document.getElementById('student-modal-id').value;
            const checks = document.querySelectorAll('#student-modal-sections-list input:checked');
            const newSecs = Array.from(checks).map(c => c.value);
            await updateDoc(doc(db, "users", sid), { accessibleSections: newSecs });
            manageModal.style.display = 'none';
        });
        document.getElementById('close-student-modal-btn').addEventListener('click', () => manageModal.style.display = 'none');


        // === AI TEXT & AUDIO ===
        const geminiApiKeyInput = document.getElementById('gemini-api-key');
        if(localStorage.getItem('geminiKey')) geminiApiKeyInput.value = localStorage.getItem('geminiKey');
        geminiApiKeyInput.addEventListener('input', () => localStorage.setItem('geminiKey', geminiApiKeyInput.value));

        async function runAI(el) {
            const key = HARDCODED_API_KEY || geminiApiKeyInput.value;
            if(!key) return alert("Insira a API Key");
            const txt = el.value; if(!txt) return;
            
            try {
                const req = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${key}`, {
                    method: 'POST', headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ contents: [{ parts: [{ text: txt }] }], systemInstruction: { parts: [{ text: "Formate este texto sobre bruxaria hekatina. Destaque termos importantes com ** e nomes de divindades com ##. Seja po√©tico." }] } })
                });
                const res = await req.json();
                el.value = res.candidates[0].content.parts[0].text;
            } catch(e) { console.error(e); }
        }
        document.getElementById('format-create-btn').addEventListener('click', () => runAI(document.getElementById('post-content')));
        document.getElementById('format-edit-btn').addEventListener('click', () => runAI(document.getElementById('edit-post-content')));

        const audioPlayer = document.getElementById('gemini-audio-player');
        const btnSpeak = document.getElementById('btn-speak');
        const btnSpeakText = document.getElementById('btn-speak-text');
        const btnStopSpeak = document.getElementById('btn-stop-speak');

        function base64ToBuffer(b64) {
            const str = window.atob(b64);
            const b = new Uint8Array(str.length);
            for(let i=0; i<str.length; i++) b[i] = str.charCodeAt(i);
            return b.buffer;
        }
        function makeWav(data) {
            const b = new ArrayBuffer(44 + data.byteLength);
            const v = new DataView(b);
            const w = (o,s)=> { for(let i=0;i<s.length;i++) v.setUint8(o+i, s.charCodeAt(i)); };
            w(0,'RIFF'); v.setUint32(4, 36+data.byteLength, true); w(8,'WAVE');
            w(12,'fmt '); v.setUint32(16,16,true); v.setUint16(20,1,true);
            v.setUint16(22,1,true); v.setUint32(24,24000,true); v.setUint32(28,48000,true);
            v.setUint16(32,2,true); v.setUint16(34,16,true); w(36,'data');
            v.setUint32(40,data.byteLength,true);
            new Uint8Array(b, 44).set(new Uint8Array(data));
            return b;
        }

        async function speak() {
            if(!audioPlayer.paused && audioPlayer.src) { audioPlayer.pause(); btnSpeakText.textContent = "Continuar"; return; }
            if(audioPlayer.paused && audioPlayer.src) { audioPlayer.play(); btnSpeakText.textContent = "Pausar"; return; }

            const key = HARDCODED_API_KEY || geminiApiKeyInput.value;
            if(!key) return alert("API Key necess√°ria.");

            btnSpeakText.textContent = "Carregando...";
            const txt = document.getElementById('post-view-content').innerText.substring(0, 4000);
            
            try {
                const req = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-tts:generateContent?key=${key}`, {
                    method: 'POST', headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        contents: [{ parts: [{ text: txt }] }],
                        generationConfig: { responseModalities: ["AUDIO"], speechConfig: { voiceConfig: { prebuiltVoiceConfig: { voiceName: "Kore" } } } }
                    })
                });
                const res = await req.json();
                const pcm = base64ToBuffer(res.candidates[0].content.parts[0].inlineData.data);
                const wav = makeWav(pcm);
                const blob = new Blob([wav], { type: 'audio/wav' });
                audioPlayer.src = URL.createObjectURL(blob);
                
                audioPlayer.onplay = () => { btnSpeakText.textContent = "Pausar"; btnStopSpeak.classList.remove('hidden'); };
                audioPlayer.onended = stopSpeaking;
                audioPlayer.play();
            } catch(e) { console.error(e); btnSpeakText.textContent = "Ouvir"; }
        }

        function stopSpeaking() {
            if(audioPlayer.src) { audioPlayer.pause(); audioPlayer.src = ""; }
            btnSpeakText.textContent = "Ouvir o Chamado"; btnStopSpeak.classList.add('hidden');
        }

        btnSpeak.addEventListener('click', speak);
        btnStopSpeak.addEventListener('click', stopSpeaking);
        document.getElementById('back-to-posts-btn').addEventListener('click', () => {
            stopSpeaking();
            showView('blog-view');
        });

    </script>
</body>
</html>9
