<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ordo Rex Lucifer | A Chama Negra</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <script>
        // üîÆ CONFIGURA√á√ÉO VISUAL - TEMA LUCIFERIANO üîÆ
        const CURRENT_THEME = 'RexLucifer'; 

        const THEMES = {
            'RexLucifer': { 
                name: 'Lux Tenebris', 
                primary: { 400: '#FFD700', 500: '#B8860B', 900: '#1C1C1C' }, // Ouro Imperial e Sombra
                accent: '#8B0000', // Sangue Carmesim
                particle: 'üî•' // Fogo da Ilumina√ß√£o
            }
        };

        const activeTheme = THEMES[CURRENT_THEME];

        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        void: '#000000', // Preto absoluto
                        primary: activeTheme.primary,
                        obsidian: '#0a0a0a', // Quase preto
                        accent: activeTheme.accent,
                        royal: '#1a1a1a'
                    },
                    fontFamily: {
                        display: ['Cinzel', 'serif'], // Fonte com serifa majestosa
                        body: ['Lato', 'sans-serif'],
                    },
                    animation: { 
                        'pulse-slow': 'pulse 4s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                        'spin-slow': 'spin 12s linear infinite'
                    }
                }
            }
        }
    </script>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;500;600;700;900&family=Lato:wght@300;400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>

    <style>
        /* ESTILOS GERAIS */
        body { background-color: #000; color: #d4d4d4; overflow-x: hidden; }
        
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #000; }
        ::-webkit-scrollbar-thumb { background: linear-gradient(to bottom, var(--accent-color), var(--primary-color)); border-radius: 3px; }

        .glass-dark {
            background: rgba(10, 10, 10, 0.8);
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 215, 0, 0.05); /* Borda dourada sutil */
        }

        /* TEXTO DOURADO BRILHANTE */
        .text-gradient-gold {
            background: linear-gradient(to right, #B8860B, #FFD700, #F0E68C, #B8860B);
            -webkit-background-clip: text; background-clip: text; color: transparent; 
            background-size: 300% auto; animation: shine 6s linear infinite;
        }
        @keyframes shine { to { background-position: 300% center; } }
        
        .fade-in-up { animation: fadeInUp 0.8s ease-out forwards; opacity: 0; transform: translateY(20px); }
        @keyframes fadeInUp { to { opacity: 1; transform: translateY(0); } }
        
        /* INPUTS ESTILIZADOS */
        .input-luxe { 
            background: rgba(255, 255, 255, 0.02); 
            border: 1px solid rgba(255, 215, 0, 0.1); 
            color: #FFD700; 
            transition: 0.3s; 
            font-family: 'Cinzel', serif;
        }
        .input-luxe:focus { 
            outline: none; 
            border-color: #FFD700; 
            background: rgba(255, 215, 0, 0.05); 
            box-shadow: 0 0 15px rgba(184, 134, 11, 0.2);
        }
        .input-luxe::placeholder { color: #555; font-family: 'Lato', sans-serif; }

        /* PARTICLES (BRASAS SUBINDO) */
        .particle-container { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 1; overflow: hidden; }
        .particle {
            position: absolute; opacity: 0;
            animation: fireRise linear infinite;
            filter: blur(1px);
        }
        @keyframes fireRise {
            0% { opacity: 0; transform: translateY(100vh) scale(0.5); }
            20% { opacity: 0.6; }
            80% { opacity: 0.6; }
            100% { opacity: 0; transform: translateY(-10vh) scale(1.5); }
        }

        /* CARD DE V√çDEO / SE√á√ÉO */
        .project-card {
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative; overflow: hidden;
            background: linear-gradient(180deg, #0a0a0a 0%, #050505 100%);
        }
        .project-card:hover {
            transform: translateY(-5px);
            border-color: #FFD700;
            box-shadow: 0 10px 40px -10px rgba(0, 0, 0, 1), 0 0 20px rgba(255, 215, 0, 0.1);
        }
        .project-card::before {
            content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 1px;
            background: linear-gradient(90deg, transparent, #FFD700, transparent);
            opacity: 0.3;
        }

        /* SVG ESTRELA DA MANH√É */
        .morning-star-svg {
            filter: drop-shadow(0 0 20px rgba(255, 215, 0, 0.3));
            animation: floatStar 6s ease-in-out infinite alternate;
        }
        .star-core { transform-origin: center; animation: spin-slow 20s linear infinite; }
        .star-rays { transform-origin: center; animation: pulse-slow 4s ease-in-out infinite; }
        
        @keyframes floatStar { 0% { transform: translateY(0); } 100% { transform: translateY(-15px); } }

        /* TRILHA (PATH SYSTEM) */
        .path-container-wrapper {
            position: relative; width: 100%; overflow-x: hidden; min-height: 600px;
            display: flex; justify-content: center; padding-top: 40px; padding-bottom: 100px;
        }
        .path-svg-line { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 0; pointer-events: none; }
        .path-node-wrapper { position: absolute; transform: translate(-50%, -50%); z-index: 2; display: flex; flex-direction: column; align-items: center; }
        
        .game-node {
            width: 70px; height: 70px; border-radius: 50%; display: flex; align-items: center; justify-content: center;
            font-size: 1.5rem; cursor: pointer; position: relative; transition: transform 0.3s;
            box-shadow: 0 0 15px rgba(0,0,0,0.8); border: 2px solid #333;
            background: #000;
        }
        .game-node:active { transform: scale(0.95); }

        .game-node.status-completed {
            background: radial-gradient(circle, #B8860B, #3D3008);
            border: 2px solid #FFD700; color: #000; 
            box-shadow: 0 0 25px rgba(255, 215, 0, 0.4);
        }
        .game-node.status-active {
            background: #8B0000; border: 2px solid #ff4444; color: #fff;
            box-shadow: 0 0 30px rgba(139, 0, 0, 0.6); animation: pulseActive 2s infinite;
        }
        @keyframes pulseActive {
            0% { box-shadow: 0 0 0 0 rgba(139, 0, 0, 0.7); }
            70% { box-shadow: 0 0 0 15px rgba(139, 0, 0, 0); }
            100% { box-shadow: 0 0 0 0 rgba(139, 0, 0, 0); }
        }
        .game-node.status-locked {
            background: #050505; border: 2px solid #222; color: #333; cursor: not-allowed;
        }
        
        /* Time Lock Special Style */
        .game-node.status-time-locked {
            background: #0a0000; border: 2px dashed #500; color: #500; cursor: not-allowed; opacity: 0.7;
        }

        .node-label {
            position: absolute; top: 85px; background: #111; color: #FFD700; padding: 5px 12px; border: 1px solid #333;
            font-family: 'Cinzel', serif; font-size: 0.7rem; text-transform: uppercase; letter-spacing: 1px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.9); opacity: 0; transform: translateY(-10px); transition: 0.3s; pointer-events: none;
            text-align: center; min-width: 140px; left: 50%; transform: translateX(-50%); z-index: 10;
        }
        .path-node-wrapper:hover .node-label { opacity: 1; transform: translateX(-50%) translateY(0); }
        
        /* Tooltip para Bloqueio de Tempo */
        .locked-tooltip {
            position: absolute; bottom: 85px; background: #2a0000; color: #ff8888; padding: 8px 12px; border: 1px solid #800;
            font-size: 0.6rem; text-transform: uppercase; letter-spacing: 1px; text-align: center;
            width: 160px; pointer-events: none; opacity: 0; transition: 0.3s; left: 50%; transform: translateX(-50%);
            z-index: 20; box-shadow: 0 0 20px rgba(0,0,0,1);
        }
        .path-node-wrapper:hover .game-node.status-time-locked ~ .locked-tooltip { opacity: 1; }

        .video-wrapper {
            position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden;
            background: #000; border: 1px solid #333; box-shadow: 0 0 50px rgba(0,0,0,1);
        }
        .video-wrapper iframe { position: absolute; top: 0; left: 0; width: 100%; height: 100%; }

    </style>
</head>
<body class="antialiased font-body selection:bg-primary-900 selection:text-white">

    <div class="particle-container" id="particles"></div>
    <script>
        const root = document.documentElement;
        root.style.setProperty('--primary-main', activeTheme.primary[400]);
        root.style.setProperty('--primary-light', activeTheme.primary[500]);
        root.style.setProperty('--accent-color', activeTheme.accent);

        const pContainer = document.getElementById('particles');
        for (let i = 0; i < 40; i++) {
            const p = document.createElement('div');
            p.className = 'particle';
            p.innerHTML = Math.random() > 0.5 ? '‚ú¶' : 'üî•';
            p.style.left = Math.random() * 100 + '%';
            p.style.animationDuration = Math.random() * 5 + 3 + 's';
            p.style.animationDelay = Math.random() * 5 + 's';
            p.style.fontSize = Math.random() * 10 + 5 + 'px';
            p.style.color = Math.random() > 0.7 ? '#FFD700' : '#8B0000';
            pContainer.appendChild(p);
        }
    </script>

    <div id="app-root">
        
        <div id="loading-spinner" class="fixed inset-0 bg-black z-50 flex flex-col items-center justify-center hidden">
            <div class="relative mb-6">
                <i class="fas fa-crown text-5xl text-primary-500 animate-pulse"></i>
            </div>
            <p class="text-primary-400 text-xs tracking-[0.5em] uppercase font-display">Invocando a Luz...</p>
        </div>

        <!-- HEADER -->
        <header class="fixed top-0 w-full z-40 bg-black/80 backdrop-blur-md border-b border-primary-500/10 h-24 transition-all duration-300">
            <div class="container mx-auto px-6 h-full flex justify-between items-center">
                <div class="flex items-center gap-4 cursor-pointer group" onclick="showView('home-view')">
                    <div class="h-12 w-12 bg-gradient-to-br from-primary-900 to-black rounded-sm flex items-center justify-center border border-primary-500/30 group-hover:border-primary-400 transition shadow-[0_0_15px_rgba(184,134,11,0.2)]">
                        <i class="fas fa-crown text-primary-400 text-xl"></i>
                    </div>
                    <div class="flex flex-col">
                        <span class="text-[9px] text-accent uppercase tracking-[0.4em] font-bold">Ordo</span>
                        <h1 class="text-xl font-display font-bold text-white tracking-widest group-hover:text-primary-400 transition">REX LUCIFER</h1>
                    </div>
                </div>

                <nav class="hidden md:flex items-center space-x-10">
                    <button data-view="home-view" class="internal-link text-[10px] font-display font-bold tracking-[0.2em] text-gray-500 hover:text-primary-400 uppercase transition">Templo</button>
                    <button data-view="blog-view" class="internal-link text-[10px] font-display font-bold tracking-[0.2em] text-gray-500 hover:text-primary-400 uppercase transition">Arquivos da Chama</button>
                    
                    <div class="w-[1px] h-6 bg-primary-500/20"></div>
                    
                    <div id="user-info" class="hidden items-center gap-4">
                        <button onclick="showView('profile-view')" class="flex items-center gap-3 text-gray-400 hover:text-primary-400 transition group">
                            <i id="header-user-icon" class="fas fa-user-astronaut"></i>
                            <div class="flex flex-col text-right">
                                <span class="text-[9px] text-accent uppercase tracking-widest">Iniciado</span>
                                <span id="header-user-name" class="text-[10px] hidden sm:inline uppercase font-display tracking-widest text-white group-hover:text-primary-400"></span>
                            </div>
                        </button>
                        <button id="logout-btn" class="text-gray-600 hover:text-red-600 text-xs transition" title="Sair"><i class="fas fa-sign-out-alt"></i></button>
                    </div>
                    <button id="login-btn" class="hidden px-6 py-2 border border-primary-500/30 text-[10px] font-display font-bold text-primary-400 uppercase tracking-widest hover:bg-primary-900/20 hover:border-primary-400 transition">Acesso</button>
                </nav>
            </div>
        </header>

        <main class="pt-24 min-h-screen relative z-10">
            
            <!-- HOME VIEW REFORMULADA -->
            <div id="home-view" class="view-container">
                <!-- HERO SECTION -->
                <section class="relative min-h-[90vh] flex flex-col items-center justify-center text-center px-4 overflow-hidden">
                    <!-- Fundo Sombrio com Brilho Central -->
                    <div class="absolute inset-0 z-0 bg-[radial-gradient(circle_at_center,rgba(184,134,11,0.15)_0%,rgba(0,0,0,1)_70%)]"></div>
                    <div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-[800px] h-[800px] border border-primary-500/5 rounded-full animate-pulse-slow pointer-events-none"></div>
                    <div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-[600px] h-[600px] border border-primary-500/10 rounded-full pointer-events-none"></div>

                    <div class="relative z-10 max-w-5xl mx-auto space-y-8">
                        <div class="flex justify-center mb-6">
                            <i class="fas fa-fire text-3xl text-accent animate-pulse"></i>
                        </div>
                        
                        <h2 class="text-primary-500 text-xs md:text-sm tracking-[0.8em] uppercase fade-in-up font-display border-b border-primary-500/20 pb-4 inline-block">
                            Lux Ex Tenebris
                        </h2>
                        
                        <h1 class="text-5xl md:text-8xl font-display font-black text-white leading-tight fade-in-up uppercase" style="animation-delay: 0.2s">
                            Desperte a <br><span class="text-gradient-gold">Divindade</span> Interior
                        </h1>
                        
                        <p class="text-gray-400 max-w-2xl mx-auto text-lg font-body font-light leading-relaxed fade-in-up" style="animation-delay: 0.4s">
                            Bem-vindo √† <strong>Ordo Rex Lucifer</strong>. Aqui, a escurid√£o n√£o √© o fim, mas o √∫tero onde a verdadeira luz √© forjada pela vontade indom√°vel.
                        </p>
                        
                        <div class="pt-10 fade-in-up flex justify-center gap-6" style="animation-delay: 0.6s">
                            <button data-view="blog-view" class="internal-link px-12 py-4 bg-primary-900/20 border border-primary-500 text-primary-400 font-display text-xs font-bold tracking-[0.3em] uppercase hover:bg-primary-500 hover:text-black transition shadow-[0_0_30px_rgba(184,134,11,0.1)] relative group overflow-hidden">
                                <span class="relative z-10">Iniciar a Jornada</span>
                                <div class="absolute inset-0 bg-primary-500 opacity-0 group-hover:opacity-100 transition duration-500"></div>
                            </button>
                        </div>
                    </div>
                </section>

                <!-- FILOSOFIA & SOBRE (EXTENSA) -->
                <section class="py-32 px-6 bg-obsidian border-t border-primary-900/20 relative overflow-hidden">
                    <div class="absolute top-0 left-0 w-full h-full bg-[radial-gradient(ellipse_at_top,_var(--tw-gradient-stops))] from-accent/5 via-transparent to-transparent pointer-events-none"></div>

                    <div class="max-w-7xl mx-auto grid md:grid-cols-2 gap-20 items-center relative z-10">
                        <div class="order-2 md:order-1 space-y-10 text-justify">
                            <div>
                                <h3 class="text-4xl font-display text-white mb-2 flex items-center gap-4">
                                    <span class="text-primary-500 text-6xl opacity-50">I.</span> A Doutrina da Luz Oculta
                                </h3>
                                <div class="h-[1px] w-24 bg-accent mt-4"></div>
                            </div>
                            
                            <p class="text-gray-400 font-body leading-loose text-lg">
                                O Luciferianismo, em sua ess√™ncia, n√£o √© a adora√ß√£o do mal, mas a rever√™ncia ao <strong>Intelecto Desperto</strong>. L√∫cifer, o <em>Portador da Luz</em>, √© o arqu√©tipo daquele que questiona, que busca a sabedoria proibida e que se recusa a curvar-se diante da estagna√ß√£o.
                            </p>
                            
                            <p class="text-gray-400 font-body leading-loose text-lg">
                                Sob a orienta√ß√£o do Sacerdote <strong>Black Lord</strong>, a Ordo Rex Lucifer oferece um caminho estruturado para aqueles que desejam retomar a coroa de sua pr√≥pria exist√™ncia. Rejeitamos a culpa herdada e abra√ßamos a responsabilidade total pelo nosso destino.
                            </p>

                            <div class="bg-black/50 border-l-2 border-primary-500 p-6">
                                <p class="text-primary-400 font-display italic text-lg mb-2">"A Chama Negra √© a centelha divina individualizada. √â a consci√™ncia que separa o Eu do Todo, permitindo a cria√ß√£o consciente."</p>
                                <p class="text-gray-600 text-xs uppercase tracking-widest">‚Äî Codex Luciferi</p>
                            </div>
                        </div>

                        <!-- ILUSTRA√á√ÉO SVG: A ESTRELA DA MANH√É -->
                        <div class="order-1 md:order-2 flex justify-center relative h-[500px] items-center">
                             <div class="absolute inset-0 bg-gradient-to-br from-primary-500/10 to-accent/10 blur-[100px] rounded-full pointer-events-none animate-pulse"></div>
                            
                            <svg class="morning-star-svg w-full h-full max-w-md" viewBox="0 0 500 500" xmlns="http://www.w3.org/2000/svg">
                                <defs>
                                    <linearGradient id="starGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                                        <stop offset="0%" style="stop-color:#FFD700;stop-opacity:1" />
                                        <stop offset="100%" style="stop-color:#B8860B;stop-opacity:1" />
                                    </linearGradient>
                                    <filter id="glow">
                                        <feGaussianBlur stdDeviation="4" result="coloredBlur"/>
                                        <feMerge>
                                            <feMergeNode in="coloredBlur"/>
                                            <feMergeNode in="SourceGraphic"/>
                                        </feMerge>
                                    </filter>
                                </defs>
                                
                                <g class="star-core" transform="translate(250,250)">
                                    <polygon points="0,-100 22,-30 95,-30 36,15 58,85 0,45 -58,85 -36,15 -95,-30 -22,-30" fill="none" stroke="url(#starGradient)" stroke-width="2" />
                                    <circle cx="0" cy="0" r="10" fill="#FFD700" filter="url(#glow)"/>
                                </g>

                                <g class="star-rays" transform="translate(250,250)">
                                    <path d="M0,-180 L10,-40 L0,0 L-10,-40 Z" fill="url(#starGradient)" opacity="0.8" />
                                    <path d="M0,180 L10,40 L0,0 L-10,40 Z" fill="url(#starGradient)" opacity="0.8" />
                                    <path d="M180,0 L40,-10 L0,0 L40,10 Z" fill="url(#starGradient)" opacity="0.8" />
                                    <path d="M-180,0 L-40,-10 L0,0 L-40,10 Z" fill="url(#starGradient)" opacity="0.8" />
                                    
                                    <path d="M120,-120 L30,-30 L0,0" stroke="#8B0000" stroke-width="1" opacity="0.6"/>
                                    <path d="M-120,120 L-30,30 L0,0" stroke="#8B0000" stroke-width="1" opacity="0.6"/>
                                    <path d="M120,120 L30,30 L0,0" stroke="#8B0000" stroke-width="1" opacity="0.6"/>
                                    <path d="M-120,-120 L-30,-30 L0,0" stroke="#8B0000" stroke-width="1" opacity="0.6"/>
                                </g>
                                
                                <circle cx="250" cy="250" r="160" fill="none" stroke="#333" stroke-width="1" stroke-dasharray="5,10" opacity="0.5" class="animate-[spin_30s_linear_infinite]" />
                            </svg>
                        </div>
                    </div>
                </section>

                <!-- PILARES DA ORDEM (GRID) -->
                <section class="py-24 px-6 bg-void relative overflow-hidden">
                    <div class="absolute top-0 w-full h-[1px] bg-gradient-to-r from-transparent via-primary-500/30 to-transparent"></div>
                    <div class="max-w-7xl mx-auto">
                        <div class="text-center mb-16 space-y-4">
                            <i class="fas fa-chess-king text-primary-500 text-3xl opacity-80"></i>
                            <h3 class="text-4xl font-display text-white uppercase tracking-widest">Os Pilares da Ascens√£o</h3>
                            <p class="text-gray-500 text-xs uppercase tracking-[0.3em]">As bases do nosso Templo</p>
                        </div>

                        <div class="grid md:grid-cols-3 gap-8">
                            <!-- Card 1 -->
                            <div class="project-card border border-white/5 p-10 relative group cursor-pointer h-full" onclick="showView('blog-view')">
                                <div class="absolute top-0 right-0 p-6 opacity-10 group-hover:opacity-30 transition duration-500">
                                    <i class="fas fa-book-dead text-8xl text-primary-900"></i>
                                </div>
                                <h4 class="text-2xl font-display text-primary-400 mb-6 group-hover:text-white transition uppercase">Gnose <span class="text-[10px] block text-gray-600 tracking-widest mt-1">Conhecimento</span></h4>
                                <p class="text-gray-400 text-sm leading-relaxed mb-8 min-h-[80px]">
                                    Estudo profundo de magia cerimonial, psicologia sombria e filosofia ocultista. O saber √© a √∫nica arma que n√£o enferruja.
                                </p>
                                <span class="text-[10px] font-bold text-accent uppercase tracking-widest group-hover:text-white transition flex items-center gap-2">Explorar Arquivos <i class="fas fa-arrow-right"></i></span>
                            </div>

                            <!-- Card 2 -->
                            <div class="project-card border border-white/5 p-10 relative group cursor-pointer h-full bg-royal">
                                <div class="absolute top-0 right-0 p-6 opacity-10 group-hover:opacity-30 transition duration-500">
                                    <i class="fas fa-fist-raised text-8xl text-accent"></i>
                                </div>
                                <h4 class="text-2xl font-display text-primary-400 mb-6 group-hover:text-white transition uppercase">Potentia <span class="text-[10px] block text-gray-600 tracking-widest mt-1">Poder Pessoal</span></h4>
                                <p class="text-gray-400 text-sm leading-relaxed mb-8 min-h-[80px]">
                                    Pr√°ticas para fortalecer a Vontade. Rituais de empoderamento e a arte de moldar a realidade conforme o desejo do Magista.
                                </p>
                                <span class="text-[10px] font-bold text-accent uppercase tracking-widest group-hover:text-white transition flex items-center gap-2">Ver Rituais <i class="fas fa-fire"></i></span>
                            </div>

                            <!-- Card 3 -->
                            <div class="project-card border border-white/5 p-10 relative group cursor-pointer h-full">
                                <div class="absolute top-0 right-0 p-6 opacity-10 group-hover:opacity-30 transition duration-500">
                                    <i class="fas fa-users text-8xl text-primary-900"></i>
                                </div>
                                <h4 class="text-2xl font-display text-primary-400 mb-6 group-hover:text-white transition uppercase">Fraternitas <span class="text-[10px] block text-gray-600 tracking-widest mt-1">O C√≠rculo Interno</span></h4>
                                <p class="text-gray-400 text-sm leading-relaxed mb-8 min-h-[80px]">
                                    Uma comunidade seleta de iniciados. Aqui, a lealdade e a troca de experi√™ncias elevam todos os membros.
                                </p>
                                <span class="text-[10px] font-bold text-accent uppercase tracking-widest group-hover:text-white transition flex items-center gap-2">Unir-se √† Ordem <i class="fas fa-user-plus"></i></span>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- CALL TO ACTION FINAL -->
                <section class="py-28 px-6 border-t border-primary-900/30 bg-[#020202] text-center relative overflow-hidden">
                     <div class="absolute inset-0 bg-gradient-to-t from-accent/5 to-transparent blur-[100px] pointer-events-none"></div>
                    <div class="max-w-3xl mx-auto space-y-10 relative z-10">
                        <div class="mb-4">
                            <i class="fas fa-skull text-4xl text-accent animate-pulse"></i>
                        </div>
                        <h3 class="text-4xl md:text-5xl font-display text-white uppercase leading-tight">
                            O Chamado do Abismo
                        </h3>
                        <p class="text-gray-400 font-body leading-loose text-lg">
                            Muitos ouvem o sussurro, poucos t√™m a coragem de responder. <br>
                            Se voc√™ sente a Chama Negra queimar em seu peito, seu lugar √© entre os Reis e Rainhas desta era.
                        </p>
                        <div class="pt-6">
                            <button onclick="document.getElementById('login-view').style.display='flex'" class="inline-block border border-primary-500 px-12 py-5 text-primary-400 font-display text-xs font-bold tracking-[0.4em] uppercase hover:bg-primary-900 hover:text-white hover:border-primary-900 transition duration-500 shadow-[0_0_20px_rgba(184,134,11,0.2)]">
                                Requerer Inicia√ß√£o
                            </button>
                        </div>
                        <p class="text-[9px] text-gray-600 uppercase tracking-widest mt-8">A porta est√° aberta, mas o caminho √© estreito.</p>
                    </div>
                </section>
            </div>

            <!-- ACERVO / BLOG VIEW -->
            <div id="blog-view" class="view-container hidden max-w-7xl mx-auto pt-10 px-4">
                
                <!-- PAINEL ADMIN -->
                <div id="admin-panel" class="hidden mb-16 p-8 bg-royal border border-primary-500/20 rounded-none relative overflow-hidden shadow-[0_0_50px_rgba(0,0,0,0.5)]">
                    <div class="absolute top-0 w-full h-1 bg-gradient-to-r from-transparent via-primary-500 to-transparent"></div>
                    <h3 class="text-primary-400 font-display text-2xl mb-8 flex items-center gap-3 relative z-10"><i class="fas fa-chess-king"></i> Painel do Magister Templi</h3>
                    
                    <div class="grid lg:grid-cols-2 gap-12 relative z-10">
                        <form id="create-post-form" class="space-y-6">
                            <h4 class="text-gray-500 text-xs uppercase tracking-[0.2em] border-b border-white/5 pb-2">Novo Rito de Conhecimento</h4>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <input type="text" id="post-title" class="input-luxe w-full p-4 text-lg" placeholder="Nome do Ritual (T√≠tulo)" required>
                                <input type="text" id="post-subtitle" class="input-luxe w-full p-4 text-sm" placeholder="Arcano (Subt√≠tulo)" required>
                            </div>
                            
                            <div class="p-6 bg-black border border-white/5 space-y-4">
                                <p class="text-[10px] text-accent uppercase tracking-widest font-bold"><i class="fab fa-google-drive mr-2"></i>Chaves do Drive</p>
                                <input type="url" id="post-video-link" class="input-luxe w-full p-3 text-sm" placeholder="Link do V√çDEO (Google Drive)" required>
                                <input type="url" id="post-pdf-link" class="input-luxe w-full p-3 text-sm" placeholder="Link do PDF (Google Drive)" required>
                            </div>

                            <textarea id="post-content" rows="3" class="input-luxe w-full p-4 text-sm font-body" placeholder="Palavras de introdu√ß√£o..."></textarea>
                            
                            <div class="grid grid-cols-2 gap-6">
                                <select id="post-access" class="input-luxe w-full p-3 bg-black cursor-pointer text-xs uppercase"><option value="aberto">üëÅÔ∏è Exot√©rico (Aberto)</option><option value="pago">üóùÔ∏è Esot√©rico (Fechado)</option></select>
                                <select id="post-section" class="input-luxe w-full p-3 bg-black cursor-pointer text-xs uppercase" required><option value="">Carregando Caminhos...</option></select>
                            </div>

                            <button type="submit" class="w-full bg-primary-900/20 border border-primary-500 text-primary-400 py-4 font-display font-bold uppercase text-xs tracking-[0.3em] hover:bg-primary-500 hover:text-black transition">Consagrar Aula</button>
                            <p id="post-status" class="text-center text-xs h-4 text-primary-500 font-display"></p>
                        </form>

                        <div class="space-y-8">
                            <!-- Gest√£o de Alunos -->
                            <div class="bg-black/40 p-6 border border-white/5 flex flex-col h-full relative group">
                                <div class="absolute -inset-0.5 bg-gradient-to-r from-primary-500/20 to-accent/20 opacity-0 group-hover:opacity-100 transition duration-500 blur"></div>
                                <div class="relative bg-black p-4 h-full">
                                    <h4 class="text-gray-400 text-xs uppercase tracking-widest mb-6 flex items-center justify-between border-b border-white/5 pb-2">
                                        <span><i class="fas fa-users mr-2"></i>Livro dos Iniciados</span>
                                        <span id="student-count" class="text-primary-500 font-display text-lg">0</span>
                                    </h4>
                                    
                                    <form id="create-account-form" class="flex flex-col gap-3 mb-6">
                                        <input type="email" id="new-email" placeholder="Email do Ne√≥fito" class="input-luxe p-3 text-xs" required>
                                        <input type="password" id="new-password" placeholder="Senha de Acesso" class="input-luxe p-3 text-xs" required>
                                        <button type="submit" id="create-student-btn" class="bg-white/5 hover:bg-white/10 text-gray-300 py-2 text-[10px] uppercase tracking-widest transition border border-white/10">Registrar</button>
                                        <p id="account-status" class="text-xs h-4 text-center"></p>
                                    </form>

                                    <div class="flex-1 overflow-y-auto custom-scrollbar max-h-[250px]">
                                        <div id="students-list-container" class="space-y-1"></div>
                                    </div>
                                </div>
                            </div>

                            <!-- Gest√£o de M√≥dulos -->
                            <div class="bg-black/40 p-6 border border-white/5">
                                <h4 class="text-gray-400 text-xs uppercase tracking-widest mb-4">Caminhos (Trilhas)</h4>
                                <form id="create-section-form" class="flex gap-2 mb-4">
                                    <input type="text" id="section-name" placeholder="Nome do Caminho" class="input-luxe w-full p-2 text-xs">
                                    <button type="submit" class="text-primary-400 hover:text-white px-2"><i class="fas fa-plus"></i></button>
                                </form>
                                <div id="sections-list-admin" class="max-h-32 overflow-y-auto text-xs text-gray-500 custom-scrollbar space-y-2"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- HUB DE SE√á√ïES -->
                <div id="sections-hub" class="mb-20">
                    <div class="text-center mb-16 space-y-6">
                        <i class="fas fa-dungeon text-primary-500 text-4xl opacity-80"></i>
                        <h3 class="text-5xl font-display text-white uppercase">Arquivos da Chama</h3>
                        <div class="h-[1px] w-24 bg-gradient-to-r from-transparent via-accent to-transparent mx-auto"></div>
                        <p class="text-gray-500 text-xs uppercase tracking-[0.3em]">Escolha o portal que deseja atravessar</p>
                    </div>
                    <div id="sections-cards-container" class="grid md:grid-cols-2 lg:grid-cols-3 gap-10">
                        <div class="col-span-full text-center py-20">
                            <i class="fas fa-circle-notch fa-spin text-primary-900 text-4xl"></i>
                        </div>
                    </div>
                </div>

                <!-- TRILHA / PATH VIEW -->
                <div id="active-path-view" class="hidden mb-20 relative">
                    <button id="back-to-hub-btn" class="fixed top-28 left-6 z-30 text-primary-500/70 hover:text-primary-400 text-[10px] uppercase tracking-[0.2em] flex items-center gap-3 transition bg-black/80 p-3 border border-primary-500/20 hover:border-primary-500 font-display">
                        <i class="fas fa-chevron-left"></i> Voltar aos Portais
                    </button>

                    <div class="text-center mb-20 pt-8 relative z-10">
                        <h2 id="path-title" class="text-4xl font-display text-white mb-4 uppercase text-gradient-gold"></h2>
                        <span class="text-gray-600 text-[10px] uppercase tracking-[0.5em] border-t border-b border-gray-800 py-2">Trilha de Ascens√£o</span>
                    </div>

                    <div class="relative w-full md:max-w-4xl max-w-md mx-auto min-h-[600px] px-4 pb-20">
                        <!-- Fundo da Trilha -->
                        <div class="absolute inset-0 bg-gradient-to-b from-primary-900/5 via-transparent to-transparent pointer-events-none"></div>
                        <div id="path-steps-container" class="path-container-wrapper"></div>
                        <p id="empty-path-msg" class="hidden text-center text-gray-600 text-sm italic mt-10 font-display">O caminho ainda n√£o foi revelado.</p>
                    </div>
                </div>
            </div>

            <!-- PERFIL -->
            <div id="profile-view" class="view-container hidden max-w-2xl mx-auto pt-10 px-4">
                 <div class="bg-royal border border-white/10 p-10 relative overflow-hidden shadow-2xl text-center">
                     <i class="fas fa-id-card-alt text-6xl text-white/5 absolute top-5 right-5"></i>
                     <h2 class="text-3xl font-display text-white mb-2">Credencial da Ordem</h2>
                     <div class="h-[1px] w-full bg-gradient-to-r from-transparent via-primary-500 to-transparent my-6 opacity-30"></div>
                     <p class="text-xs text-primary-500 uppercase tracking-widest mb-2">Identidade Espiritual</p>
                     <p id="profile-email-display" class="text-xl text-white font-display tracking-wider mb-6"></p>
                     
                     <p id="profile-admin-badge" class="hidden inline-block border border-accent/50 text-accent px-4 py-2 text-[10px] uppercase tracking-[0.2em] font-bold">
                        <i class="fas fa-crown mr-2"></i> Magister Templi
                     </p>
                     
                     <div class="mt-10 bg-black/50 p-4 border border-white/5">
                         <p class="text-[10px] text-gray-600 uppercase">Seu progresso √© registrado no livro da vida.</p>
                     </div>
                 </div>
            </div>

        </main>

        <!-- MODAL DE LOGIN -->
        <div id="login-view" class="view-container hidden fixed inset-0 z-50 bg-black/95 backdrop-blur-md flex items-center justify-center p-4">
            <div class="w-full max-w-md relative bg-royal p-12 border border-primary-500/20 shadow-[0_0_100px_rgba(0,0,0,1)]">
                <button id="close-login-btn" class="absolute top-4 right-4 text-gray-600 hover:text-white transition"><i class="fas fa-times"></i></button>
                
                <div class="text-center mb-12">
                    <i class="fas fa-fire text-accent text-3xl mb-4"></i>
                    <h2 id="login-title" class="text-3xl font-display text-white tracking-[0.2em] uppercase">Sanctum</h2>
                    <div class="h-[1px] w-12 bg-accent mx-auto my-4"></div>
                    <p id="login-subtitle" class="text-[10px] text-gray-500 uppercase tracking-[0.4em]">Identifique-se</p>
                </div>
                
                <form id="login-form" class="space-y-8">
                    <div class="group relative">
                        <input type="email" id="login-email" placeholder="EMAIL" class="w-full bg-transparent border-b border-gray-800 p-4 text-center text-white outline-none font-display tracking-widest focus:border-primary-500 transition-colors placeholder:text-gray-700">
                    </div>
                    <div class="group relative">
                        <input type="password" id="login-password" placeholder="SENHA" class="w-full bg-transparent border-b border-gray-800 p-4 text-center text-white outline-none font-display tracking-widest focus:border-primary-500 transition-colors placeholder:text-gray-700">
                    </div>
                    <button type="submit" id="login-submit-btn" class="w-full border border-primary-900 text-primary-400 py-5 uppercase text-[10px] tracking-[0.4em] hover:bg-primary-500 hover:text-black transition font-bold mt-4 shadow-[0_0_20px_rgba(0,0,0,0.5)]">Adentrar</button>
                </form>

                <div class="text-center mt-10 pt-8 border-t border-white/5">
                    <button id="toggle-register-btn" class="text-gray-600 text-[9px] uppercase tracking-[0.2em] hover:text-white transition">Solicitar Inicia√ß√£o (Criar Conta)</button>
                </div>

                <p id="login-error" class="text-center text-accent text-xs mt-6 font-display tracking-wider"></p>
            </div>
        </div>

        <!-- PLAYER DE V√çDEO (AULA) -->
        <div id="post-view" class="view-container hidden fixed inset-0 z-[60] bg-black overflow-y-auto custom-scrollbar">
            <div class="max-w-6xl mx-auto min-h-screen bg-royal border-x border-white/5 relative shadow-2xl">
                <!-- Top Bar -->
                <div class="sticky top-0 z-20 bg-royal/95 backdrop-blur border-b border-white/5 p-4 flex justify-between items-center h-20 shadow-lg px-8">
                    <button id="back-to-posts-btn" class="text-gray-400 text-[10px] uppercase tracking-[0.2em] hover:text-primary-400 transition flex items-center gap-3 group font-display">
                        <i class="fas fa-long-arrow-alt-left text-lg group-hover:-translate-x-1 transition"></i> Retornar
                    </button>
                    <div class="admin-only-controls hidden gap-4">
                        <button id="post-view-delete-btn" class="text-red-900 hover:text-red-500 transition text-xs uppercase tracking-widest border border-red-900/30 px-4 py-2 hover:bg-red-900/10"><i class="fas fa-trash mr-2"></i> Excluir Registro</button>
                    </div>
                </div>

                <div class="p-0">
                    <!-- √ÅREA DO V√çDEO -->
                    <div class="w-full bg-black border-b border-primary-500/20 relative">
                        <div class="absolute inset-0 bg-accent/5 pointer-events-none"></div>
                        <div class="max-w-5xl mx-auto video-wrapper">
                            <iframe id="video-iframe" src="" frameborder="0" allow="autoplay; fullscreen" allowfullscreen></iframe>
                        </div>
                    </div>

                    <div class="p-8 md:p-16 pb-32">
                        <!-- T√çTULO E DOWNLOAD -->
                        <div class="flex flex-col md:flex-row justify-between items-start gap-12 mb-12 border-b border-white/5 pb-12">
                            <div class="flex-1 space-y-4">
                                <span class="text-accent text-[9px] uppercase tracking-[0.4em] font-bold block border-l-2 border-accent pl-3">Rito em Andamento</span>
                                <h1 id="post-view-title" class="text-4xl md:text-5xl font-display text-white leading-tight uppercase"></h1>
                                <h3 id="post-view-subtitle" class="text-xl text-primary-500 font-display italic"></h3>
                            </div>
                            
                            <a id="post-view-pdf-btn" href="#" target="_blank" class="shrink-0 bg-black border border-primary-900 hover:border-primary-500 text-gray-300 hover:text-white px-8 py-5 font-display font-bold uppercase tracking-[0.2em] text-[10px] flex items-center gap-4 transition group">
                                <i class="fas fa-scroll text-2xl text-primary-500 group-hover:text-white transition"></i> 
                                <div class="text-left">
                                    <span class="block text-[8px] text-gray-600">Documento Sagrado</span>
                                    <span>Baixar PDF</span>
                                </div>
                            </a>
                        </div>

                        <!-- DESCRI√á√ÉO -->
                        <div class="mb-16 grid grid-cols-1 lg:grid-cols-3 gap-12">
                            <div class="lg:col-span-2">
                                <h4 class="text-gray-600 text-[10px] uppercase tracking-[0.2em] mb-6"><i class="fas fa-align-left mr-2"></i>Escrituras do Mestre</h4>
                                <div id="post-view-content" class="prose prose-invert max-w-none text-gray-400 font-body leading-loose text-justify border-l border-white/5 pl-6"></div>
                            </div>
                            
                            <!-- BOT√ÉO CONCLUIR (LADO DIREITO) -->
                            <div class="flex flex-col items-center justify-center bg-black/30 p-8 border border-white/5 h-fit">
                                <i class="fas fa-certificate text-4xl text-gray-800 mb-6"></i>
                                <p class="text-center text-gray-500 text-xs mb-6">Ao finalizar o estudo, sele a sua mente.</p>
                                <button id="mark-complete-btn" class="w-full bg-transparent border border-primary-500/30 text-primary-400 hover:bg-primary-500 hover:text-black py-4 font-display font-bold uppercase tracking-[0.2em] text-[10px] transition transform hover:scale-105 flex items-center justify-center gap-3">
                                    <i class="fas fa-check-circle text-lg"></i> Consagrar Leitura
                                </button>
                            </div>
                        </div>
                        
                        <!-- COMENT√ÅRIOS -->
                        <div id="comments-section" class="border-t border-white/5 pt-12">
                             <h3 class="text-2xl font-display text-white mb-8"><i class="fas fa-comments text-primary-900 mr-3"></i> Di√°logo da Ordem</h3>
                             
                             <div id="comments-list" class="space-y-6 mb-10"></div>
                             
                             <div id="comment-form-container" class="hidden bg-black p-6 border border-white/10">
                                 <p class="text-[10px] text-gray-500 uppercase tracking-widest mb-4">Sua voz no abismo</p>
                                 <textarea id="comment-input" class="input-luxe w-full p-4 text-sm mb-4 bg-obsidian" rows="3" placeholder="Escreva sua reflex√£o..."></textarea>
                                 <button id="submit-comment-btn" class="text-primary-400 text-[10px] uppercase tracking-[0.2em] hover:text-white transition font-bold border border-primary-900/30 px-6 py-3 hover:bg-primary-900/10">Enviar Oferenda</button>
                             </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <!-- FIREBASE MODULE -->
    <script type="module">
        import { initializeApp, deleteApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, addDoc, onSnapshot, doc, getDoc, setDoc, query, deleteDoc, updateDoc, orderBy, increment, where, arrayUnion } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        const firebaseConfig = {
          apiKey: "AIzaSyDBIIcYpc0UGYOEYUMziqRbRFCKwwFKHWo",
          authDomain: "black-f70c1.firebaseapp.com",
          projectId: "black-f70c1",
          storageBucket: "black-f70c1.firebasestorage.app",
          messagingSenderId: "405843705668",
          appId: "1:405843705668:web:7a6ab1a8bdb2016aaf2111"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        
        // üö® MANTENHA O ADMIN UID AQUI üö®
        const ADMIN_UID = "COLE_SEU_UID_AQUI"; 

        // STATE
        let currentUser = null;
        let currentUserData = null; // Guardar dados completos para ver datas
        let completedPosts = [];
        let allPosts = [];
        let allSections = [];
        let activeSectionId = null;
        let currentPostId = null;
        let commentsUnsubscribe = null;
        let isRegisterMode = false;
        let studentsUnsubscribe = null; 

        // UI REFS
        const loadingSpinner = document.getElementById('loading-spinner');
        const loginBtn = document.getElementById('login-btn');
        const logoutBtn = document.getElementById('logout-btn');
        const userInfo = document.getElementById('user-info');
        const adminPanel = document.getElementById('admin-panel');
        const sectionsHub = document.getElementById('sections-hub');
        const activePathView = document.getElementById('active-path-view');

        // === NAV ===
        window.showView = function(viewId) {
            ['home-view', 'blog-view', 'profile-view', 'post-view', 'login-view'].forEach(id => {
                const el = document.getElementById(id);
                if(el) {
                    if(id === 'post-view' || id === 'login-view') el.style.display = 'none'; 
                    else el.style.display = (id === viewId) ? 'block' : 'none';
                }
            });

            if(viewId === 'login-view') {
                document.getElementById('login-view').style.display = 'flex';
                resetLoginForm();
            }
            if(viewId === 'post-view') document.getElementById('post-view').style.display = 'block';

            if(viewId === 'blog-view') {
                if(!activeSectionId) {
                    sectionsHub.classList.remove('hidden');
                    activePathView.classList.add('hidden');
                } else {
                    sectionsHub.classList.add('hidden');
                    activePathView.classList.remove('hidden');
                    renderProfessionalPath(activeSectionId); // RENDERIZA A TRILHA (AGORA COM L√ìGICA DE TEMPO)
                }
            }
            window.scrollTo(0,0);
        };

        document.querySelectorAll('.internal-link').forEach(btn => {
            btn.addEventListener('click', (e) => showView(e.currentTarget.dataset.view));
        });

        // === AUTH & LOGIN/REGISTER TOGGLE ===
        const toggleRegBtn = document.getElementById('toggle-register-btn');
        const loginTitle = document.getElementById('login-title');
        const loginSubtitle = document.getElementById('login-subtitle');
        const loginSubmitBtn = document.getElementById('login-submit-btn');

        function resetLoginForm() {
            isRegisterMode = false;
            updateLoginUI();
            document.getElementById('login-form').reset();
            document.getElementById('login-error').textContent = "";
        }

        function updateLoginUI() {
            if (isRegisterMode) {
                loginTitle.textContent = "INICIA√á√ÉO";
                loginSubtitle.textContent = "Solicitar Acesso";
                loginSubmitBtn.textContent = "Requerer Entrada";
                toggleRegBtn.textContent = "J√° √© iniciado? Adentrar";
            } else {
                loginTitle.textContent = "SANCTUM";
                loginSubtitle.textContent = "Identifique-se";
                loginSubmitBtn.textContent = "Adentrar";
                toggleRegBtn.textContent = "Solicitar Inicia√ß√£o (Criar Conta)";
            }
        }

        toggleRegBtn.addEventListener('click', () => {
            isRegisterMode = !isRegisterMode;
            updateLoginUI();
        });

        document.getElementById('login-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const email = document.getElementById('login-email').value;
            const pass = document.getElementById('login-password').value;
            const errorMsg = document.getElementById('login-error');
            errorMsg.textContent = "Invocando...";

            try {
                if (isRegisterMode) {
                    const cred = await createUserWithEmailAndPassword(auth, email, pass);
                    await setDoc(doc(db, "users", cred.user.uid), { 
                        email, 
                        createdAt: new Date(), 
                        completedPosts: [],
                        completionDates: {} // Inicia objeto de datas vazio
                    });
                    window.location.reload();
                } else {
                    await signInWithEmailAndPassword(auth, email, pass);
                }
            } catch (err) {
                console.error(err);
                errorMsg.textContent = "Acesso Negado: " + err.code;
            }
        });

        onAuthStateChanged(auth, async (user) => {
            if (user) {
                currentUser = user;
                userInfo.style.display = 'flex';
                loginBtn.style.display = 'none';
                document.getElementById('header-user-name').textContent = user.email.split('@')[0];
                document.getElementById('profile-email-display').textContent = user.email;
                document.getElementById('comment-form-container').classList.remove('hidden');

                if (user.uid === ADMIN_UID) {
                    adminPanel.style.display = 'block'; 
                    document.querySelectorAll('.admin-only-controls').forEach(e => e.classList.remove('hidden'));
                    document.getElementById('profile-admin-badge').classList.remove('hidden');
                    fetchStudents(); 
                } else {
                    adminPanel.style.display = 'none';
                    document.querySelectorAll('.admin-only-controls').forEach(e => e.classList.add('hidden'));
                    document.getElementById('profile-admin-badge').classList.add('hidden');
                }

                const userDoc = await getDoc(doc(db, "users", user.uid));
                if(userDoc.exists()) {
                    currentUserData = userDoc.data();
                    completedPosts = currentUserData.completedPosts || [];
                }
                
                if(document.getElementById('login-view').style.display === 'flex') showView('blog-view');
            } else {
                currentUser = null;
                currentUserData = null;
                userInfo.style.display = 'none';
                loginBtn.style.display = 'block';
                adminPanel.style.display = 'none';
                document.querySelectorAll('.admin-only-controls').forEach(e => e.classList.add('hidden'));
                document.getElementById('comment-form-container').classList.add('hidden');
                if(studentsUnsubscribe) studentsUnsubscribe(); 
            }
            fetchSections();
            fetchPosts();
        });

        document.getElementById('login-btn').addEventListener('click', () => showView('login-view'));
        document.getElementById('close-login-btn').addEventListener('click', () => showView('home-view'));
        document.getElementById('logout-btn').addEventListener('click', () => signOut(auth));

        // === DATA ===
        function fetchSections() {
            onSnapshot(query(collection(db, "sections"), orderBy("name")), (snap) => {
                allSections = [];
                const select = document.getElementById('post-section');
                const container = document.getElementById('sections-cards-container');
                const listAdmin = document.getElementById('sections-list-admin');
                
                select.innerHTML = '<option value="">Selecione o Caminho</option>';
                container.innerHTML = '';
                listAdmin.innerHTML = '';

                snap.forEach(d => {
                    const s = { id: d.id, ...d.data() };
                    allSections.push(s);
                    select.add(new Option(s.name, s.id));
                    listAdmin.innerHTML += `<div class="flex justify-between p-2 border-b border-white/5 uppercase">${s.name} <button onclick="deleteSection('${s.id}')" class="text-red-900 hover:text-red-500"><i class="fas fa-times"></i></button></div>`;
                    
                    const card = document.createElement('div');
                    card.className = "project-card border border-white/5 p-10 relative group cursor-pointer flex flex-col items-center justify-center text-center min-h-[300px]";
                    card.onclick = () => openPath(s.id, s.name);
                    card.innerHTML = `
                        <div class="absolute inset-0 bg-[radial-gradient(circle,rgba(255,215,0,0.1)_0%,rgba(0,0,0,0)_70%)] opacity-0 group-hover:opacity-100 transition duration-700"></div>
                        <i class="fas fa-dharmachakra text-6xl text-gray-800 mb-8 group-hover:text-primary-500 transition transform group-hover:rotate-180 duration-1000"></i>
                        <h4 class="text-2xl font-display text-white mb-2 group-hover:text-primary-400 transition uppercase tracking-widest">${s.name}</h4>
                        <p class="text-[9px] text-gray-600 uppercase tracking-[0.4em]">Adentrar Portal</p>
                    `;
                    container.appendChild(card);
                });
            });
        }

        function fetchPosts() {
            onSnapshot(query(collection(db, "posts"), orderBy("createdAt", "asc")), (snap) => {
                allPosts = [];
                snap.forEach(d => allPosts.push({ id: d.id, ...d.data() }));
                if(activeSectionId) renderProfessionalPath(activeSectionId);
            });
        }

        // === ADMIN LOGIC ===
        function fetchStudents() {
            const listContainer = document.getElementById('students-list-container');
            const countBadge = document.getElementById('student-count');
            if(studentsUnsubscribe) studentsUnsubscribe();

            studentsUnsubscribe = onSnapshot(query(collection(db, "users")), (snap) => {
                listContainer.innerHTML = '';
                let count = 0;
                snap.forEach(d => {
                    if (d.id === ADMIN_UID) return; 
                    count++;
                    const user = d.data();
                    const row = document.createElement('div');
                    row.className = "flex justify-between items-center p-3 bg-white/5 border border-white/5 hover:bg-white/10 transition";
                    row.innerHTML = `
                        <div class="overflow-hidden">
                            <p class="text-[10px] text-gray-300 truncate font-display tracking-wider">${user.email}</p>
                        </div>
                        <button onclick="deleteStudent('${d.id}')" class="text-red-900 hover:text-red-500 transition px-2">
                            <i class="fas fa-skull"></i>
                        </button>
                    `;
                    listContainer.appendChild(row);
                });
                countBadge.textContent = count;
                if (count === 0) listContainer.innerHTML = '<p class="text-center text-gray-600 text-[10px] uppercase tracking-widest py-4">Nenhum ne√≥fito registrado.</p>';
            });
        }

        document.getElementById('create-account-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const email = document.getElementById('new-email').value;
            const pass = document.getElementById('new-password').value;
            const status = document.getElementById('account-status');
            const btn = document.getElementById('create-student-btn');

            status.textContent = "Registrando...";
            btn.disabled = true;

            try {
                const secondaryApp = initializeApp(firebaseConfig, "SecondaryApp");
                const secondaryAuth = getAuth(secondaryApp);
                const userCred = await createUserWithEmailAndPassword(secondaryAuth, email, pass);
                await setDoc(doc(db, "users", userCred.user.uid), {
                    email: email, createdAt: new Date(), completedPosts: [], completionDates: {}, role: 'student'
                });
                await signOut(secondaryAuth);
                await deleteApp(secondaryApp);

                status.textContent = "Iniciado Registrado.";
                status.className = "text-xs h-4 text-center text-primary-400";
                document.getElementById('create-account-form').reset();
            } catch (err) {
                status.textContent = "Erro: " + err.code;
                status.className = "text-xs h-4 text-center text-red-500";
            }
            btn.disabled = false;
        });

        window.deleteStudent = async (uid) => {
            if(confirm("Banir este iniciado da Ordem?")) {
                try { await deleteDoc(doc(db, "users", uid)); } catch(e) { console.error(e); }
            }
        };

        document.getElementById('create-section-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const n = document.getElementById('section-name').value;
            if(n) { await addDoc(collection(db, "sections"), { name: n, createdAt: new Date() }); e.target.reset(); }
        });

        window.deleteSection = async (id) => { if(confirm("Selar este Caminho?")) await deleteDoc(doc(db, "sections", id)); };

        document.getElementById('create-post-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const status = document.getElementById('post-status');
            status.textContent = "Consagrando...";
            const secSelect = document.getElementById('post-section');
            try {
                await addDoc(collection(db, "posts"), {
                    title: document.getElementById('post-title').value,
                    subtitle: document.getElementById('post-subtitle').value,
                    videoURL: document.getElementById('post-video-link').value,
                    pdfURL: document.getElementById('post-pdf-link').value,
                    content: document.getElementById('post-content').value,
                    access: document.getElementById('post-access').value,
                    sectionId: secSelect.value,
                    createdAt: new Date()
                });
                status.textContent = "Ritual Arquivado.";
                e.target.reset();
            } catch(err) { console.error(err); status.textContent = "Falha no rito."; }
        });

        function openPath(id, name) {
            activeSectionId = id;
            document.getElementById('path-title').textContent = name;
            document.getElementById('sections-hub').classList.add('hidden');
            document.getElementById('active-path-view').classList.remove('hidden');
            renderProfessionalPath(id);
        }

        document.getElementById('back-to-hub-btn').addEventListener('click', () => {
            activeSectionId = null;
            document.getElementById('active-path-view').classList.add('hidden');
            document.getElementById('sections-hub').classList.remove('hidden');
        });

        // üï∞Ô∏è HELPER DE DATA PARA O C√ÅLCULO DE TRAVA DE TEMPO üï∞Ô∏è
        function getNextMonday(date) {
            const d = new Date(date);
            d.setDate(d.getDate() + ((7 - d.getDay() + 1) % 7 || 7));
            d.setHours(0,0,0,0);
            return d;
        }

        function renderProfessionalPath(sectionId) {
            const container = document.getElementById('path-steps-container');
            container.innerHTML = '';
            
            // 1. Pega e ordena os posts da trilha
            const posts = allPosts.filter(p => p.sectionId === sectionId).sort((a,b) => (a.createdAt?.seconds||0) - (b.createdAt?.seconds||0));
            
            if(posts.length === 0) {
                document.getElementById('empty-path-msg').classList.remove('hidden');
                return;
            }
            document.getElementById('empty-path-msg').classList.add('hidden');

            const svg = document.createElementNS("http://www.w3.org/2000/svg", "svg");
            svg.setAttribute("class", "path-svg-line");
            const spacing = 180;
            const totalHeight = (posts.length * spacing) + 200;
            container.style.height = totalHeight + 'px';
            svg.style.height = totalHeight + 'px';
            container.appendChild(svg);

            let pathD = "";
            const centerX = container.offsetWidth / 2;
            let prevX = centerX;
            let prevY = 50;

            // üï∞Ô∏è L√ìGICA DE GRUPOS DE 3 (SEMANAL)
            // Calculamos o √∫ltimo √≠ndice dispon√≠vel baseado no tempo
            let maxUnlockedIndex = 9999;
            
            if (currentUser && currentUser.uid !== ADMIN_UID) {
                maxUnlockedIndex = 0; // Come√ßa liberando s√≥ o grupo 0 (index 0,1,2)
                
                // Itera pelos GRUPOS de 3
                for (let group = 0; group < 100; group++) {
                    // Pega o √∫ltimo post do grupo anterior
                    // Grupo 0: posts 0,1,2.
                    // Para desbloquear Grupo 1, precisamos ter terminado Grupo 0 E esperado at√© segunda.
                    const lastPostOfPrevGroupIndex = ((group) * 3) - 1; 
                    
                    if (lastPostOfPrevGroupIndex < 0) {
                        // Grupo 0 √© sempre liberado inicialmente
                        maxUnlockedIndex = 2; // Libera √≠ndices 0,1,2
                        continue;
                    }

                    // Checa se o post final do grupo anterior existe
                    if (lastPostOfPrevGroupIndex >= posts.length) break;

                    const lastPostOfPrevGroup = posts[lastPostOfPrevGroupIndex];
                    
                    // Checa se completou o √∫ltimo post do grupo anterior
                    if (completedPosts.includes(lastPostOfPrevGroup.id)) {
                        
                        // RECUPERA DATA DE CONCLUS√ÉO
                        // Fallback para epoch 0 se n√£o tiver data (compatibilidade com contas antigas)
                        let compDate = new Date(0); 
                        if (currentUserData && currentUserData.completionDates && currentUserData.completionDates[lastPostOfPrevGroup.id]) {
                            compDate = currentUserData.completionDates[lastPostOfPrevGroup.id].toDate();
                        }

                        // Calcula pr√≥xima segunda-feira ap√≥s a conclus√£o
                        const unlockDate = getNextMonday(compDate);
                        const now = new Date();

                        if (now >= unlockDate) {
                            // Passou do tempo! Desbloqueia o pr√≥ximo grupo (ex: libera +3)
                            maxUnlockedIndex = ((group + 1) * 3) - 1;
                        } else {
                            // Travado pelo tempo. Pare de calcular.
                            break;
                        }
                    } else {
                        // N√£o completou o grupo anterior, ent√£o n√£o libera o pr√≥ximo
                        break;
                    }
                }
            }

            posts.forEach((p, i) => {
                const isCompleted = completedPosts.includes(p.id);
                const isAdmin = currentUser && currentUser.uid === ADMIN_UID;
                
                // L√ìGICA DE BLOQUEIO:
                // 1. Sequencial padr√£o: Anterior deve estar completo (exceto o primeiro).
                // 2. Trava de Tempo (Segunda-feira): Index deve ser <= maxUnlockedIndex.
                
                let isLocked = false;
                let isTimeLocked = false;

                if (!isAdmin) {
                    if (i > maxUnlockedIndex) {
                        isLocked = true;
                        isTimeLocked = true; // Travado especificamente pelo sistema de semanas
                    } else if (i > 0 && !completedPosts.includes(posts[i-1].id)) {
                        isLocked = true; // Travado porque n√£o fez o anterior
                    }
                }
                
                // SVG Drawing
                const y = 50 + (i * spacing);
                const x = centerX + Math.sin(i * 1.5) * (window.innerWidth < 768 ? 60 : 120);

                if (i === 0) pathD += `M ${x} ${y}`;
                else pathD += ` Q ${prevX} ${(prevY + y) / 2}, ${x} ${y}`;
                prevX = x; prevY = y;

                const node = document.createElement('div');
                node.className = "path-node-wrapper";
                node.style.left = x + 'px';
                node.style.top = y + 'px';
                
                let statusClass = isLocked ? 'status-locked' : (isCompleted ? 'status-completed' : 'status-active');
                if (isTimeLocked) statusClass += ' status-time-locked'; // Adiciona estilo especial para trava de tempo

                let icon = isLocked ? 'fa-lock' : (isCompleted ? 'fa-crown' : 'fa-fire');
                if (isTimeLocked) icon = 'fa-hourglass-half'; // √çcone de ampulheta para trava de tempo

                let clickFn = `openClass('${p.id}')`;
                if (isTimeLocked) {
                    clickFn = "alert('‚è≥ O selo deste conhecimento s√≥ se romper√° na pr√≥xima segunda-feira, ap√≥s a conclus√£o do ciclo anterior.')";
                } else if (isLocked) {
                    clickFn = "alert('üîí O conhecimento deve ser conquistado em ordem. Complete o rito anterior.')";
                }

                const tooltipHtml = isTimeLocked ? 
                    `<div class="locked-tooltip"><i class="fas fa-moon mr-1"></i> Aguarde a pr√≥xima<br>Segunda-feira</div>` : 
                    `<div class="node-label">${p.title}</div>`;

                node.innerHTML = `
                    <div class="game-node ${statusClass}" onclick="${clickFn}">
                        <i class="fas ${icon}"></i>
                    </div>
                    ${tooltipHtml}
                `;
                container.appendChild(node);
            });

            const path = document.createElementNS("http://www.w3.org/2000/svg", "path");
            path.setAttribute("d", pathD);
            path.setAttribute("stroke", "#333");
            path.setAttribute("stroke-width", "4");
            path.setAttribute("fill", "none");
            svg.appendChild(path);
        }

        window.openClass = function(id) { openPost(id); }

        function getDriveEmbedLink(url) {
            if (!url) return '';
            if (url.includes('drive.google.com')) {
                return url.replace(/\/view.*/, '/preview').replace(/\/edit.*/, '/preview');
            }
            return url;
        }

        async function openPost(id) {
            loadingSpinner.classList.remove('hidden');
            const snap = await getDoc(doc(db, "posts", id));
            if(snap.exists()) {
                const p = snap.data();
                currentPostId = id;
                document.getElementById('post-view-title').textContent = p.title;
                document.getElementById('post-view-subtitle').textContent = p.subtitle || '';
                document.getElementById('post-view-content').textContent = p.content || '';
                document.getElementById('video-iframe').src = getDriveEmbedLink(p.videoURL);
                const pdfBtn = document.getElementById('post-view-pdf-btn');
                if(p.pdfURL) {
                    pdfBtn.href = p.pdfURL;
                    pdfBtn.classList.remove('hidden');
                } else {
                    pdfBtn.classList.add('hidden');
                }
                const compBtn = document.getElementById('mark-complete-btn');
                if(completedPosts.includes(id)) {
                    compBtn.className = "w-full bg-primary-900/10 border border-primary-500/30 text-gray-500 py-4 font-display font-bold uppercase tracking-[0.2em] text-[10px] cursor-default flex items-center justify-center gap-3";
                    compBtn.innerHTML = '<i class="fas fa-crown"></i> Conhecimento Absorvido';
                    compBtn.onclick = null;
                } else {
                    compBtn.className = "w-full bg-transparent border border-primary-500 text-primary-400 hover:bg-primary-500 hover:text-black py-4 font-display font-bold uppercase tracking-[0.2em] text-[10px] transition transform hover:scale-105 flex items-center justify-center gap-3";
                    compBtn.innerHTML = '<i class="fas fa-check-circle text-lg"></i> Consagrar Leitura';
                    compBtn.onclick = markComplete;
                }
                
                document.getElementById('post-view-delete-btn').onclick = async () => {
                    if(confirm("Apagar este registro sagrado?")) {
                        await deleteDoc(doc(db, "posts", id));
                        showView('blog-view');
                    }
                };

                loadComments(id);
                showView('post-view');
            }
            loadingSpinner.classList.add('hidden');
        }

        document.getElementById('back-to-posts-btn').addEventListener('click', () => {
            document.getElementById('video-iframe').src = "";
            showView('blog-view');
        });

        async function markComplete() {
            if(!currentUser || !currentPostId) return alert("Identifique-se primeiro.");
            try {
                // AGORA SALVAMOS TAMB√âM A DATA DE CONCLUS√ÉO
                await updateDoc(doc(db, "users", currentUser.uid), { 
                    completedPosts: arrayUnion(currentPostId),
                    [`completionDates.${currentPostId}`]: new Date() // Timestamp para a l√≥gica de tempo
                });
                
                if(!completedPosts.includes(currentPostId)) completedPosts.push(currentPostId);
                
                // Atualiza o objeto local tamb√©m para refletir imediatamente sem recarregar
                if(currentUserData) {
                    if(!currentUserData.completionDates) currentUserData.completionDates = {};
                    currentUserData.completionDates[currentPostId] = { toDate: () => new Date() }; // Simula timestamp do Firestore
                }

                openPost(currentPostId);
            } catch(e) { console.error(e); }
        }

        function loadComments(postId) {
            if(commentsUnsubscribe) commentsUnsubscribe();
            commentsUnsubscribe = onSnapshot(query(collection(db, "comments"), where("postId", "==", postId)), (snap) => {
                const list = document.getElementById('comments-list');
                list.innerHTML = '';
                if(snap.empty) { list.innerHTML = '<p class="text-gray-700 font-display text-[10px] uppercase tracking-widest text-center">O sil√™ncio impera.</p>'; return; }
                let comms = [];
                snap.forEach(d => comms.push({id: d.id, ...d.data()}));
                comms.sort((a,b) => (b.createdAt?.seconds||0) - (a.createdAt?.seconds||0));
                comms.forEach(c => {
                    const div = document.createElement('div');
                    div.className = "bg-white/5 p-6 border-l-2 border-primary-900";
                    div.innerHTML = `
                        <div class="flex justify-between mb-2">
                            <span class="text-primary-500 text-[10px] font-bold uppercase tracking-widest">${c.userName}</span>
                            <span class="text-gray-600 text-[9px]">${new Date(c.createdAt?.toDate()).toLocaleDateString()}</span>
                        </div>
                        <p class="text-gray-400 text-sm font-light italic">"${c.content}"</p>
                    `;
                    list.appendChild(div);
                });
            });
        }

        document.getElementById('submit-comment-btn').addEventListener('click', async () => {
            const txt = document.getElementById('comment-input').value;
            if(!currentUser || !txt) return;
            await addDoc(collection(db, "comments"), {
                postId: currentPostId,
                userName: currentUser.email.split('@')[0],
                content: txt,
                createdAt: new Date()
            });
            document.getElementById('comment-input').value = '';
        });

    </script>
</body>
</html>
